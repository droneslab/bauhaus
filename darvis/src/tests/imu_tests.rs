
mod sim3solver_tests {
    use core::{config::{load_config, SETTINGS}, matrix::{DVMatrix, DVMatrix3, DVVector3, DVVectorOfKeyPoint}, read_only_lock::ReadWriteMap, system::{Actor, System, Timestamp}};
    use std::{collections::{HashMap, HashSet}, env};

    use crossbeam_channel::unbounded;
    use nalgebra::{DMatrix, Matrix3, Quaternion, SMatrix, UnitQuaternion, Vector3};

    use crate::{actors::tracking_backend::TrackingBackend, map::{frame::Frame, keyframe::KeyFrame, map::Id, pose::{group_exp, Pose}}, modules::imu::{normalize_rotation, ImuBias, ImuCalib, ImuDataFrame, ImuPreIntegrated, IntegratedRotation, GRAVITY_VALUE}, registered_actors::CAMERA_MODULE};

    // #[test]
    fn test_apply_scaled_rotation() {
        let t = Pose::new(
            Vector3::new(0.0, 0.0, 0.0),
            Matrix3::new(
            0.99802708625793457,  0.049260139465332031 ,-0.038928128778934479,
            0.056640125811100006, -0.43887817859649658  , 0.89675945043563843,
            0.027089789509773254,  -0.89719510078430176,  -0.44080233573913574,
            )
        );
        let s = 6.1029448509216309;

        let old_velocity = Vector3::new(0.002648587804287672, 0.062408339232206345, 0.033924948424100876);
        let old_pose = Pose::new(
            Vector3::new(-0.00072055746568366885 ,  -0.015388553962111473 ,  -0.006493755616247654),
            Matrix3::new(
                0.99903744459152222  ,0.038806568831205368 ,-0.020450692623853683,
                -0.038588084280490875  , 0.99919497966766357 , 0.010972167365252972,
                0.020860021933913231 , -0.01017245277762413 ,  0.99973064661026001,
            )
        );

        let mut twc = old_pose.inverse().clone();
        let twc_trans = twc.get_translation();
        twc.set_translation(nalgebra::Vector3::new(twc_trans[0] * s, twc_trans[1] * s, twc_trans[2] * s)); // just scaling translation by s
        let tyc = t * twc;
        let tcy = tyc.inverse();
        let new_pose = tcy;
        let new_velocity = DVVector3::new(*t.get_rotation() * old_velocity * s);

        let expected_new_vel = Vector3::new(0.026834471151232719 ,0.019424915313720703, -0.43254566192626953);
        let expected_new_trans = Vector3::new(-0.0043975226581096649 , -0.093915477395057678 ,  -0.03963104635477066);
        let expected_new_rot = Matrix3::new(
        0.99977415800094604,  0.021214896813035011, 0.0012613671133294702,
        0.010281410999596119  ,-0.43087124824523926  ,  -0.902354896068573,
            -0.018599878996610641 ,   0.9021640419960022,  -0.43099212646484375,
        );


        assert_eq!(*new_pose.get_translation(), expected_new_trans);
        assert_eq!(*new_pose.get_rotation(), expected_new_rot);
        assert_eq!(new_velocity.transpose(), expected_new_vel.transpose());
    }

    // #[test]
    // fn test_update_frame_imu() {
    //     // Not doing this because it's too annoying to do it the legit way, but code is here if you ever need it later
    //     // Just spawn tracking
    //     // let writeable_map = ReadWriteMap::<crate::map::map::Map>::new(crate::map::map::Map::new()); 
    //     // let map_clone = writeable_map.clone();
    //     // let (tx, rx) = unbounded();
    //     // let mut transmitters = HashMap::new();
    //     // transmitters.insert("TRACKING_BACKEND".to_string(), tx);
    //     // let system = System {receiver: rx, receiver_bound: Some(10), actors: transmitters, my_name: "TRACKING_BACKEND".to_string()};
    //     // let mut tracking = TrackingBackend::new_test(system, map_clone);

    //     // Fake keyframe 
    //     struct KeyFrameDummy {
    //         id: Id,
    //         parent: Option<Id>,
    //         imu_data: ImuDataFrame,
    //         pose: Pose,
    //         imu_position: Option<DVVector3<f64>>,
    //     }
    //     impl KeyFrameDummy {
    //         pub fn get_imu_rotation(&self) -> DVMatrix3<f64> {
    //             // Eigen::Matrix3f KeyFrame::GetImuRotation()
    //             // Note: in Orbslam this is: (mTwc * mImuCalib.mTcb).rotationMatrix();
    //             // and mTwc is inverse of the pose
    //             (self.pose.inverse() * ImuCalib::new().tcb).get_rotation()
    //         }
    //         pub fn get_imu_position(&self) -> DVVector3<f64> {
    //             // Eigen::Vector3f KeyFrame::GetImuPosition()
    //             self.imu_position.expect("IMU position not set")
    //         }
    //     }

    //     // Copy of update frame imu that doesn't use tracking backend or map objects
    //     fn update_frame_imu_copy(
    //         // original variables to update_frame_imu
    //         scale: f64, imu_bias: ImuBias, current_kf_id: Id,
    //         // varialbes inside `self` ( tracking backend )
    //         trajectory_poses: Vec<Pose>, reference_kfs_for_trajectory: Vec<(Id, Option<Id>)>,
    //         current_frame: &mut Frame, last_frame: &mut Frame,
    //         // Fake map
    //         keyframes_in_map: HashMap<Id, KeyFrameDummy>, last_kf_id: Id
    //     ) {
    //         for i in 0..trajectory_poses.len() {
    //             let mut pose = trajectory_poses[i];
    //             let (mut kf, mut parent) = reference_kfs_for_trajectory[i];

    //             while keyframes_in_map.get(& kf).is_none() {
    //                 println!("KF deleted, finding parent {} {:?}", kf, parent);
    //                 if parent.is_none() {
    //                     break;
    //                 } else {
    //                     let parent_kf = keyframes_in_map.get(& parent.unwrap()).unwrap();
    //                     kf = parent_kf.id;
    //                     parent = parent_kf.parent;
    //                 }

    //             }

    //             pose.set_translation(*pose.get_translation() * (scale));
    //             println!("NEW TRANSLATION FOR KF {}: {:?}", kf, pose.get_translation());
    //         }
    //         // imu.last_bias = Some(imu_bias);
    //         last_frame.imu_data.set_new_bias(imu_bias);
    //         current_frame.imu_data.set_new_bias(imu_bias);

    //         // if(mLastFrame.mnId == mLastFrame.mpLastKeyFrame->mnFrameId)
    //         let last_kf = keyframes_in_map.get(&last_kf_id).unwrap();
    //         if last_frame.frame_id == last_kf_id {
    //             last_frame.set_imu_pose_velocity(
    //             Pose::new(
    //                 * last_kf.get_imu_position(),
    //                 * last_kf.get_imu_rotation(),
    //             ),
    //             * last_kf.imu_data.get_velocity()
    //             );
    //         } else {
    //             let gz = nalgebra::Vector3::new(0.0, 0.0, -GRAVITY_VALUE);
    //             let twb1 = * last_kf.get_imu_position();
    //             let rwb1 = * last_kf.get_imu_rotation();
    //             let vwb1 = * last_kf.imu_data.get_velocity();
    //             let t12 = last_kf.imu_data.imu_preintegrated.as_ref().unwrap().d_t;

    //             let delta_rot = last_kf.imu_data.imu_preintegrated.as_ref().unwrap().get_updated_delta_rotation();
    //             let delta_pos = last_kf.imu_data.imu_preintegrated.as_ref().unwrap().get_updated_delta_position();
    //             let delta_vel = last_kf.imu_data.imu_preintegrated.as_ref().unwrap().get_updated_delta_velocity();
    //             last_frame.set_imu_pose_velocity(
    //                 Pose::new(
    //                     twb1 + vwb1 * t12 + 0.5 * t12 * t12 * gz + rwb1 * delta_pos,
    //                     * normalize_rotation(rwb1 * delta_rot),
    //                 ),
    //                 vwb1 + gz * t12 + rwb1 * delta_vel
    //             );

    //         }

    //         if current_frame.imu_data.imu_preintegrated.is_some() {
    //             let last_kf = keyframes_in_map.get(&last_kf_id).unwrap();
    //             let gz = nalgebra::Vector3::new(0.0, 0.0, -GRAVITY_VALUE);
    //             let twb1 = * last_kf.get_imu_position();
    //             let rwb1 = * last_kf.get_imu_rotation();
    //             let vwb1 = * last_kf.imu_data.get_velocity();
    //             let t12 = last_kf.imu_data.imu_preintegrated.as_ref().unwrap().d_t;

    //             let delta_rot = current_frame.imu_data.imu_preintegrated.as_ref().unwrap().get_updated_delta_rotation();
    //             let delta_pos = current_frame.imu_data.imu_preintegrated.as_ref().unwrap().get_updated_delta_position();
    //             let delta_vel = current_frame.imu_data.imu_preintegrated.as_ref().unwrap().get_updated_delta_velocity();

    //             current_frame.set_imu_pose_velocity(
    //                 Pose::new(
    //                     twb1 + vwb1 * t12 + 0.5 * t12 * t12 * gz + rwb1 * delta_pos,
    //                     * normalize_rotation(rwb1 * delta_rot),
    //                 ),
    //                 vwb1 + gz * t12 + rwb1 * delta_vel
    //             );
    //         }
    //     }

    //     // Test!!!!!!!
    //     let mut trajectory_poses = vec![];
    //     let mut reference_kfs_for_trajectory = vec![];
    //     let mut last_frame = Frame::new_no_features(
    //         1, None, 1.0, None
    //     ).expect("Could not create frame!");
    //     let mut current_frame = Frame::new_no_features(
    //         2, None, 2.0, Some(&last_frame)
    //     ).expect("Could not create frame!");

    //     let mut keyframes_in_map = HashMap::new();
    //     keyframes_in_map.insert(
    //         0, 
    //         KeyFrameDummy {
    //             id: 0,
    //             parent: None,
    //             imu_data: todo!(),
    //             pose: todo!(),
    //             imu_position: todo!(),
    //         }
    //     );
    //     let last_kf_id = 0;

    //     let scale = 1.0;
    //     let imu_bias: ImuBias = ImuBias::new();
    //     let current_kf_id = 0;
    //     update_frame_imu_copy(
    //         scale, imu_bias, current_kf_id,
    //         trajectory_poses, reference_kfs_for_trajectory,
    //         &mut current_frame, &mut last_frame,
    //         keyframes_in_map, last_kf_id
    //     );



    // }

    // #[test]
    fn test_marginalize() {
        let h: SMatrix<f64, 30, 30> = SMatrix::from_row_slice( &[
            1409653425.605258, -157925.20366498124, 433109.99924061075, -251811.56264187914, 18175117.822994057, -3052667.1651555551, 83954.789086428471, 28244.117806185241, -11930.041958855862, -34601888.694164373, 841.22228690591112, 110491.28263056338, 0.46179786699983727, -31415.947372419618, 1914.7446914301227, -691985234.34611976, -208685.77016597879, 4716848.9384564962, 24381.149647075334, -23594496.914596178, 2552919.3819195936, -34047.306940108516, -26833.648672898653, 13103.545082655946, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0, 
            -157925.20366497975, 1401139936.2476735, 537058.56551037938, -26212634.314240307, -348259.37612781068, -85566173.78263779, 30731.096713514999, -197859.6851138724, 7896.652013420844, -490.72238549854137, -34601982.542025186, 85341.554847513966, 31534.333444371565, 100.10332402075498, 61843.92300656077, 233007.09443818039, -691825017.66461134, 2700624.8968493748, 23898962.207036488, 179742.1433449226, 43924892.438856386, -22228.251620532734, 136065.29350218567, -30530.491518936833, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0, 
            433109.99924059457, 537058.56551038357, 1389093838.3222625, 6079422.4235847546, 85292542.378789037, 598656.40000335407, 178504.89095070679, 19176.731958993827, -22960.30485359858, -110479.08270994389, -85347.809335531681, -34601768.396997713, -1867.0668726559061, -61901.334849854422, 103.70774481272927, -4546472.052877469, -2705289.2941432344, -691852073.57882893, -2445883.2982383543, -44084691.974231966, 188811.42287413738, -135049.887394163, -9139.5952633680336, 27223.554249892975, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0, 
            -251811.56264187666, -26212634.314240318, 6079422.4235847611, 48524187528.995911, 234759.11933362976, 6184692.6901352275, -111.93018705397844, 8338.6695448756218, -1975.2477566599846, -32.509973583791535, 15.18917614713153, -91.070929168770732, -112.23005379276066, 358.76062720013607, -33445.419617630505, -9913.0672755150481, 22026959.481271461, -476297.4452293606, -24241816540.388229, -7412525.5900076693, 162619252.60160899, -20578580.055134397, 286714379.04590833, 533552162.34934789, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0, 
            18175117.822994061, -348259.37612780725, 85292542.378789023, 234759.11933315397, 48530583278.093147, -4790411.2522401297, 17449.314392805099, 2677.7319578528404, 420.01948399841785, -858.68231056620664, -277.98443603879218, 387.2924467429001, -486.25249951129859, -455.93561418535165, -21287.614816291654, -22338014.400458977, -187594.56369537394, -46183542.346942663, 8072492.370088865, -24241497248.600368, 94678830.213341683, 598460069.81399333, 91826346.764867619, -26263242.854783271, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0, 
            -3052667.1651555561, -85566173.782637775, 598656.40000335546, 6184692.6901361598, -4790411.2522403607, 48497063208.538696, -2988.9507472217083, 15417.263364732265, 789.91121661663055, -97.893933257088989, 2.7054555981407158, -218.08180544260313, 33071.501604713289, 21285.907646998374, -466.44042273838397, 375001.29285899666, 46332089.699794792, -183369.12940316513, -161921398.46392274, -94739992.618964985, -24241136114.678276, -93265321.895166323, 525965320.94536734, -286261858.75949806, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0, 
            83954.789086427772, 30731.096713514999, 178504.89095070492, -111.93018706515431, 17449.31439268589, -2988.9507472217083, 40300439.793432236, -2.6436544974269767, -2.1200667007984624, 41.121125719609381, 30.159741207626187, -26.851909831927344, 8450.6709856365105, -246843.79831411681, 38508.809921443819, -47995.620496551142, -21914.72298185647, -126543.25111489077, 21402739.216669865, -598101011.55308127, 95464369.337360293, 10151781.611815715, -2.1580594767612364, -8.8643967127791825, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0, 
            28244.11780618543, -197859.68511387054, 19176.731958993885, 8338.6695448756218, 2677.7319578826427, 15417.263364672661, -2.6436544950249967, 40300448.805717096, 37.736131170224034, 6.3287108297376857, 5.1192744313620624, 32.384574470654293, -118163.97069630156, -37898.067758020843, -216997.14795866169, -12045.771212480047, 134318.48376559321, -17426.163717913776, -290204339.12065947, -93971552.376920775, -523686518.56394017, -2.1757345547888853, 10151788.253988776, -18.521259911596889, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0, 
            -11930.041958855803, 7896.6520134206949, -22960.304853598522, -1975.2477566599846, 420.01948399841785, 789.91121661663055, -2.1200667007785601, 37.736131166834639, 40303067.707721375, -0.47427888332370449, -0.4073620403061049, -0.35300986356190972, -220142.92439925243, 10866.737718416638, 117977.72667914364, 4642.7429225766646, -17837.306713501766, 10195.140070687577, -531630159.57855338, 27218902.236824848, 289721905.8662914, -0.22139356027103729, -3.7100766554645932, 10151540.752232367, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0, 
            -34601888.694164358, -490.7223854985059, -110479.08270994465, -32.509973583760782, -858.68231056620527, -97.893933257103541, 41.121125719604429, 6.3287108297419765, -0.47427888332355872, 79770215703.142944, -3.7011797358817224, -0.10527099348330964, -0.10012109712248157, -3.1529649498497889, -0.083534747781162558, 34601854.047998212, 11521.405551282707, -121134.3286925585, 32.878958375626233, 859.06823876045144, 94.319550187407145, -82.710222763836612, -17.851139483736329, 3.2157562855707909, -26589498471.930256, 0.0,  0.0,  0.0,  0.0,  0.0, 
            841.22228690587838, -34601982.542025179, -85347.809335531783, 15.189176146891167, -277.98443603875796, 2.7054555990720384, 30.159741207618818, 5.1192744314245928, -0.40736204032704121, -3.7011797358801464, 79770215705.959229, 0.25145274509986226, -0.033007430693506833, -1.87626845939535, 0.0082651526897724471, -11765.764441098068, 34602049.862700909, -49781.172057879186, -15.299376907515665, 277.96707515844963, -3.6894411657405835, -43.931868187648746, -6.7485902764514192, 1.6143935060219898, 0.0,  -26589498471.930256, 0.0,  0.0,  0.0,  0.0,
            110491.28263056425, 85341.55484751414, -34601768.396997727, -91.070929168657514, 387.29244674290004, -218.08180544261222, -26.851909831959937, 32.384574470654186, -0.35300986355826763, -0.10527099352402083, 0.25145274509328214, 79770215700.166748, -0.91560899808802476, 1.5593565564339087, -1.8940021918202794, 121126.35987666532, 49825.029862876305, 34601780.104382783, 92.657329788978473, -386.40932031792937, 218.97832480518102, 47.807226125405428, -41.068173766259349, 0.65543063520235501, 0.0,  0.0,  -26589498471.930256, 0.0,  0.0,  0.0,
            0.4617978670004777, 31534.33344437159, -1867.0668726559045, -112.23005379276053, -486.25249951112221, 33071.501604712037, 8450.6709856365178, -118163.97069630165, -220142.92439925263, -0.10012109712248751, -0.033007430694151393, -0.91560899808805229, 3345832.9046450192, -0.028900279906921143, -0.76509295989940262, -11.020405689944544, 25314.876443836616, -848.24189400252828, -109.28479264720764, 357.0411541779639, -33073.166545361732, -8728.9640452853382, 119592.73992927512, 219358.00383749593, 0.0,  0.0,  0.0,  -1111111.2823413683, 0.0,  0.0,
            -31415.947372419632, 100.10332402075598, -61901.334849854415, 358.76062720071172, -455.93561418535251, 21285.907646998301, -246843.7983141171, -37898.067758020814, 10866.737718416658, -3.152964949849129, -1.8762684593953964, 1.5593565564330987, -0.028900279906829352, 3345831.3648947864, 0.014549959852609606, -25449.236926090722, -51.665166414090159, -51327.461963973772, -501.37287790501972, 372.63781357130927, -21284.652407867281, 246656.88891911911, 38826.782711550586, -11352.657215439294, 0.0,  0.0,  0.0,  0.0,  -1111111.2823413683, 0.0, 
            1914.7446914301233, 61843.923006560741, 103.70774481272933, -33445.419617629668, -21287.614816292324, -466.44042273838397, 38508.809921443819, -216997.14795866178, 117977.7266791437, -0.083534747781158464, 0.0082651526916476918, -1.8940021918203307, -0.76509295989937853, 0.014549959852545613, 3345831.7486621165, 809.28378157580482, 51394.385354212478, -45.707827736990339, 33440.723457676104, 21299.519321939464, 159.38507575644653, -39499.513604089763, 216024.48499376717, -119392.77688380833, 0.0,  0.0,  0.0,  0.0,  0.0,  -1111111.2823413683,
            -691985234.34612, 233007.09443818114, -4546472.0528774867, -9913.0672755151463, -22338014.400458977, 375001.29285899713, -47995.620496551026, -12045.771212480018, 4642.7429225766437, 34601854.047998235, -11765.764441098105, 121126.35987666613, -11.02040568994442, -25449.236926090736, 809.28378157580437, 715591166.10261309, -83637.382912226283, 202382.72626097375, -91132.972938149309, -6088476.2610163074, 1261754.074145413, -1057815.62037509, -141149.03559345281, 34466.298569169601, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0, 
            -208685.77016597948, -691825017.66461122, -2705289.2941432367, 22026959.481271461, -187594.56369537441, 46332089.699794799, -21914.722981856685, 134318.48376559396, -17837.306713502257, 11521.405551282745, 34602049.862700924, 49825.029862876429, 25314.876443836638, -51.66516641409023, 51394.385354212427, -83637.382912225527, 707651471.58098865, 717367.95737281349, -1533727.7967736491, -460638.99050413811, -43346297.541296005, -381257.69577333244, 2395844.1479967088, -106382.50794717438, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0, 
            4716848.9384565121, 2700624.8968493766, -691852073.57882881, -476297.44522935996, -46183542.346942663, -183369.12940316409, -126543.25111489059, -17426.163717913707, 10195.140070687565, -121134.32869255931, -49781.172057879303, 34601780.104382768, -848.24189400252749, -51327.461963973779, -45.707827736990744, 202382.72626095769, 717367.95737281116, 696217693.53749359, 1588442.3544360432, 42886956.91108764, 551321.48165263853, -2151555.8871455146, -351684.98478820588, 73239.5643826265, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0, 
            24381.149647072994, 23898962.207036495, -2445883.2982383589, -24241816540.388229, 8072492.3700884329, -161921398.4639228, 21402739.216669843, -290204339.12065941, -531630159.57855338, 32.878958375657106, -15.29937690723983, 92.657329789065813, -109.28479265008635, -501.37287790444537, 33440.723457676941, -91132.972938149425, -1533727.7967736453, 1588442.3544360439, 24280964249.772655, 242866.53254506559, 5618830.9013331793, 21401344.47542334, -290197838.74113303, -531633111.58905131, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0, 
            -23594496.914596185, 179742.14334491771, -44084691.974231981, -7412525.590007239, -24241497248.600368, -94739992.618964538, -598101011.55308139, -93971552.376920775, 27218902.236824851, 859.06823876085514, 277.96707515848601, -386.40932031783143, 357.04115417813648, 372.63781357384966, 21299.519321938787, -6088476.261016313, -460638.99050413858, 42886956.91108764, 242866.53254463235, 24287915095.778584, -4202874.2330047833, -598084692.37903285, -93968918.993318707, 27218299.29089988, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0, 
            2552919.3819195959, 43924892.438856415, 188811.42287413715, 162619252.60160905, 94678830.213341236, -24241136114.678276, 95464369.337360308, -523686518.56394029, 289721905.86629146, 94.319550187390263, -3.6894411654344474, 218.97832480517718, -33073.166545362976, -21284.652407867306, 159.38507576296061, 1261754.074145413, -43346297.541295998, 551321.48165263957, 5618830.901333157, -4202874.2330043111, 24253628700.648849, 95462239.942600131, -523671615.73487186, 289722552.92587316, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0, 
            -34047.30694010821, -22228.251620532483, -135049.88739416216, -20578580.055134401, 598460069.81399333, -93265321.895166337, 10151781.611815721, -2.1757345542630566, -0.22139356012097519, -82.710222763831098, -43.931868187657294, 47.807226125413244, -8728.9640452853455, 246656.88891911905, -39499.513604089749, -1057815.6203750896, -381257.69577333255, -2151555.8871455146, 21401344.47542334, -598084692.37903273, 95462239.942600161, 20149854.458676916, -2.4739717386322133, 48.031494049504786, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0, 
            -26833.648672898798, 136065.29350218398, -9139.5952633680154, 286714379.04590833, 91826346.764867619, 525965320.94536734, -2.1580594775127651, 10151788.253988776, -3.7100766531603462, -17.851139483731199, -6.7485902764214263, -41.068173766259136, 119592.73992927505, 38826.782711550615, 216024.48499376711, -141149.03559345275, 2395844.1479967092, -351684.98478820588, -290197838.74113303, -93968918.993318707, -523671615.73487192, -2.4739717378630157, 20149868.624856465, 78.010575657247088, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0, 
            13103.54508265601, -30530.491518937619, 27223.554249893121, 533552162.34934789, -26263242.854783259, -286261858.75949806, -8.8643967121406106, -18.521259909379552, 10151540.752232367, 3.2157562855694866, 1.6143935060221246, 0.65543063519847389, 219358.00383749566, -11352.657215439312, -119392.77688380834, 34466.298569169587, -106382.5079471747, 73239.564382626486, -531633111.58905131, 27218299.290899865, 289722552.92587322, 48.031494049775475, 78.010575657396387, 20151633.740759619, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0, 
            0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  -26589498471.930256, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  26589498471.930256, 0.0,  0.0,  0.0,  0.0,  0.0, 
            0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  -26589498471.930256, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  26589498471.930256, 0.0,  0.0,  0.0,  0.0, 
            0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  -26589498471.930256, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  26589498471.930256, 0.0,  0.0,  0.0, 
            0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  -1111111.2823413683, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  1111111.2823413683, 0.0,  0.0, 
            0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  -1111111.2823413683, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  1111111.2823413683, 0.0, 
            0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  -1111111.2823413683, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  1111111.2823413683,
        ]);
        let start = 0;
        let end = 14;
        let res = crate::modules::optimizer::marginalize(h, start, end);

        let expected_res: DMatrix<f64> = DMatrix::from_row_slice(30, 30, &[
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 247802161.63252604, 856019.51508638763, -2686650.900104749, 126885.66769950945, 1192994.5708984584, -176045.88919518504, -707410.90956322197, 43196.265236431529, -317.80567825551202, 4729163.4560815962, 1734.3184994588501, 15272.112439856453, 0.18682116518730935, -12369.886349193312, 500.21224757408373,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 856019.51508638076, 243919280.69613683, 818649.16940728412, -2202085.2458218932, -175568.76423011208, -14503362.261961915, 61673.183598330528, 2133812.5053304215, 34099.418214994541, 6175.8442327962111, 4704230.7193555851, 5802.4012149240416, 12221.773735321345, 3.774633693013052, 33154.500045183195,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -2686650.900104682, 818649.1694072932, 234348132.90052003, 260901.15916995436, 14539006.481400628, 56983.127631940981, -2017137.6352322886, 44673.255466592258, -579.96114882401707, -41067.143479198188, -794.81649562433029, 4642099.4395280015, -500.83593219137157, -33212.300001283307, -31.99168877209312,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 126885.66769950872, -2202085.2458219007, 260901.15916995448, 889172704.56943512, 8617.1212061054721, 278323.66807630472, -1357876.2439736612, -21504167.540680766, -62887076.648847461, 1025.476833955548, -4586.4770398077953, -315.81820579037566, -885311.39112602652, 402.17622490172022, -4959.0710006806039,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1192994.5708984695, -175568.76423011342, 14539006.481400628, 8617.1212064400916, 889403628.30568695, -289189.65226430329, -66438732.004551291, 1801740.6190144718, 818307.97797237616, -5524.2490551391984, -1500.4098523358082, 85969.674922520222, -394.99159688993404, -885136.98059128365, -529.17572903887731,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -176045.88919518492, -14503362.261961885, 56983.127631940035, 278323.66807765875, -289189.65226456831, 887863035.9564743, -1427225.2830997128, -62849588.789840519, 21513122.752397746, 2596.6113236974638, -84530.780913546507, 689.2419754281118, 5017.7659208327159, 571.95472019213821, -885046.77180443844,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -707410.9095632222, 61673.183598330594, -2017137.6352322891, -1357876.2439736705, -66438732.00455153, -1427225.283099724, 6636913.0050419625, -186.78831969275055, 69.59962941876293, -5869.7242222128698, 616.3646582039072, -19137.388178573889, 2066.3828851651838, 99457.857459276289, 2225.4228957925948,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 43196.265236431558, 2133812.5053304224, 44673.255466592294, -21504167.540680945, 1801740.6190144829, -62849588.789840519, -186.78831969296846, 6636415.7631766945, 351.80239400639039, 375.53976928655362, 19941.019604222707, 420.41510877660556, 31618.820528318633, -2768.4708673059163, 94304.032825269329,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -317.8056782554952, 34099.418214994534, -579.96114882402799, -62887076.64884764, 818307.97797238175, 21513122.752397954, 69.599629418751931, 351.80239400269727, 6639445.285624329, -14.903774685664112, -217.95391454898157, -2.9848450693971054, 94370.899925525548, -1251.7705558723064, -31676.740883548846,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 4729163.4560815971, 6175.8442327966777, -41067.143479199214, 1025.4768339555678, -5524.2490551394358, 2596.6113236974929, -5869.7242222128698, 375.5397692865518, -14.903774685664455, 10635895535.985725, 78.107379320772466, -276.80506740279935, 0.15689613991654694, -120.30924774710827, 5.8727330877870427,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1734.3184994589053, 4704230.7193555888, -794.8164956249193, -4586.4770398075852, -1500.4098523357743, -84530.780913547176, 616.3646582039072, 19941.019604222693, -217.95391454898612, 78.107379256905929, 10635894967.159159, 51.169038733417352, 120.6738806501188, 0.53257526802226762, 337.44344398270221,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 15272.112439857068, 5802.4012149245709, 4642099.4395280099, -315.81820579039885, 85969.674922520557, 689.24197542809702, -19137.388178573896, 420.41510877660602, -2.9848450693968314, -276.80506732678958, 51.169038454526472, 10635893732.475983, -5.4842487288702175, -339.81731312667483, -0.22998697768570711,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.18682116518708611, 12221.773735321334, -500.83593219137157, -885311.39112602663, -394.99159688997304, 5017.7659208327232, 2066.3828851651842, 31618.820528318589, 94370.899925525577, 0.15689613991654491, 120.67388065011866, -5.484248728870214, 445992.82554635929, -0.015383746741206785, -0.28535650558028652,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -12369.886349193308, 3.7746336930154025, -33212.300001283293, 402.17622490176274, -885136.98059128353, 571.95472019222973, 99457.857459276231, -2768.4708673059113, -1251.7705558723085, -120.30924774710823, 0.53257526802226141, -339.81731312667461, -0.01538374674001447, 445992.0449321217, 0.0027838248611634785,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 500.2122475740843, 33154.500045183202, -31.991688772091983, -4959.07100068004, -529.17572903890925, -885046.77180443995, 2225.422895792587, 94304.032825269271, -31676.740883548828, 5.8727330877870569, 337.44344398270226, -0.2299869776856909, -0.28535650560354686, 0.0027838248757636797, 445992.12646004447,
        ]);

        assert_eq!(res, expected_res);

    }

    // #[test]
    fn test_group_exp() {
        let vzg = nalgebra::Vector3::new(1.9862374067306519, 0.066213145852088928   , 0.0);
        let quat = group_exp(& vzg);
        let mat = * quat.to_rotation_matrix().matrix();

        assert_eq!(
            mat,
            nalgebra::Matrix3::<f64>::new(
                0.99844080209732056, 0.046771813184022903, 0.030468568205833435,
                0.046771813184022903, -0.40304350852966309,  -0.91398477554321289,
                -0.030468568205833435,  0.91398477554321289,  -0.40460264682769775,
            )
        );
    }

    // #[test]
    fn test_set_pose() {
        let mut system_config = env::current_dir().unwrap();
        system_config.push("orbslam_config.yaml");
        let mut dataset_config = env::current_dir().unwrap();
        dataset_config.push("config_datasets/EUROC.yaml");
        let _ = load_config(
            &system_config.into_os_string().into_string().unwrap(),
            &dataset_config.into_os_string().into_string().unwrap()
        ).expect("Could not load config");

        let mut frame = Frame::new_no_features(
            1, None, 1.0, None
        ).expect("Could not create frame!");

        let rot = nalgebra::Matrix3::new(
        0.99875575304031372, -0.044571500271558762, -0.022366957738995552,
        0.043374180793762207, 0.99773430824279785, -0.051428589969873428,
        0.024608531966805458, 0.050394453108310699, 0.99842619895935059
        );

        let trans = nalgebra::Vector3::new(
            0.014522586017847061, 0.19346439838409424,0.075992681086063385
        );
        frame.pose = Some(Pose::new(trans, rot));
        let kf = KeyFrame::new(frame, 1, 1);

        println!("frame: {:?}", kf.get_imu_position());
        assert!(
            *kf.get_imu_position() -
            nalgebra::Vector3::new(0.039279468357563019, -0.22018085420131683, -0.074034512042999268) <
            nalgebra::Vector3::new(1e-6, 1e-6, 1e-6)
        );

    }

    // #[test]
    fn test_construct_rwg() {
        let rwg; // mRwg
        let mut dir_g: Vector3<f64> = Vector3::zeros(); // dirG

        struct KeyFrameDummy {
            id: Id,
            imu_position: nalgebra::Vector3<f64>,
            prev_kf_imu_rotation: nalgebra::Matrix3<f64>,
            prev_kf_imu_position: nalgebra::Vector3<f64>,
            updated_delta_velocity: nalgebra::Vector3<f64>,
            d_t: f64,
        }
        let keyframes: Vec<KeyFrameDummy> = vec![
            KeyFrameDummy {
                id: 44,
                imu_position: nalgebra::Vector3::new(0.064443759620189667, 0.0016115475445985794, 0.0020114034414291382),
                prev_kf_imu_rotation: nalgebra::Matrix3::new(
                    0.014865398406982422, 0.9995572566986084, -0.025774437934160233,
                    -0.99988096952438354,  0.014967083930969238, 0.0037561894860118628,
                    0.0041402950882911682,  0.025715531781315804,   0.99966073036193848
                ),
                prev_kf_imu_position: nalgebra::Vector3::new(0.065222904086112976,  -0.020706389099359512, -0.0080546028912067413),
                updated_delta_velocity: nalgebra::Vector3::new(0.97671890258789062, -0.001049284590408206, -0.44334658980369568),
                d_t: 0.10000014305114746
            },
            KeyFrameDummy {
                id: 45,
                imu_position: nalgebra::Vector3::new(0.062968924641609192,0.030613351613283157,0.014570681378245354),
                prev_kf_imu_rotation: nalgebra::Matrix3::new(
                    0.046516299247741699 ,  0.99800312519073486 ,-0.042735561728477478,
                    -0.99863743782043457 , 0.047474026679992676 , 0.021674863994121552,
                    0.023660413920879364,  0.041669085621833801 ,  0.99885129928588867
                ),
                prev_kf_imu_position: nalgebra::Vector3::new(0.064443759620189667,0.0016115475445985794,0.0020114034414291382),
                updated_delta_velocity: nalgebra::Vector3::new(3.1740756034851074,-0.0074799382127821445,   -1.4652607440948486),
                d_t: 0.29999995231628418
            },
            KeyFrameDummy {
                id: 46,
                imu_position: nalgebra::Vector3::new(0.061159200966358185, -0.0080592501908540726,-0.00043367152102291584),
                prev_kf_imu_rotation: nalgebra::Matrix3::new(
                    0.053050458431243896 ,  0.99718391895294189 ,-0.053009651601314545,
                    -0.99719446897506714,  0.055708885192871094 , 0.049997903406620026,
                    0.052810214459896088 , 0.050208516418933868  ,  0.9973415732383728,
                ),
                prev_kf_imu_position: nalgebra::Vector3::new(0.062968924641609192,0.030613351613283157,0.014570681378245354),
                updated_delta_velocity: nalgebra::Vector3::new(2.665168285369873,-0.099234789609909058,  -1.3247029781341553),
                d_t: 0.25
            },
            KeyFrameDummy {
                id: 47,
                imu_position: nalgebra::Vector3::new(0.061743244528770447,-0.072799377143383026,-0.027681313455104828),
                prev_kf_imu_rotation: nalgebra::Matrix3::new(
                    0.038724839687347412 ,  0.99706417322158813 ,-0.066057860851287842,
                    -0.99729031324386597 , 0.042702555656433105 , 0.059906039386987686,
                    0.062551006674766541,  0.063558995723724365 ,  0.99601584672927856,                
                ),
                prev_kf_imu_position: nalgebra::Vector3::new(0.061159200966358185, -0.0080592501908540726,-0.00043367152102291584),
                updated_delta_velocity: nalgebra::Vector3::new(2.2120797634124756,-0.011208789423108101,  -1.1418012380599976),
                d_t: 0.25
            },
            KeyFrameDummy {
                id: 48,
                imu_position: nalgebra::Vector3::new(0.062551297247409821, -0.11401627957820892,-0.050050429999828339),
                prev_kf_imu_rotation: nalgebra::Matrix3::new(
                    0.05898892879486084 ,  0.99613022804260254, -0.065153829753398895,
                    -0.9976203441619873,   0.05649179220199585 ,-0.039527565240859985,
                    -0.0356939397752285 , 0.067330479621887207 ,  0.99709206819534302,                
                ),
                prev_kf_imu_position: nalgebra::Vector3::new(0.061743244528770447,-0.072799377143383026,-0.027681313455104828),
                updated_delta_velocity: nalgebra::Vector3::new(1.7533444166183472,-0.035631515085697174, -0.71447086334228516),
                d_t: 0.25
            },
            KeyFrameDummy {
                id: 49,
                imu_position: nalgebra::Vector3::new(0.062667049467563629,-0.092444159090518951,-0.039206214249134064),
                prev_kf_imu_rotation: nalgebra::Matrix3::new(
                    0.055915892124176025  , 0.99745321273803711, -0.044278018176555634,
                    -0.98980820178985596,  0.049560904502868652 , -0.13350474834442139,
                    -0.13097026944160461 , 0.051291782408952713 ,   0.9900585412979126 ,               ),
                prev_kf_imu_position: nalgebra::Vector3::new(0.062551297247409821, -0.11401627957820892,-0.050050429999828339),
                updated_delta_velocity: nalgebra::Vector3::new(1.7159998416900635,-0.015462535433471203, -0.45654833316802979),
                d_t: 0.25
            },
            KeyFrameDummy {
                id: 50,
                imu_position: nalgebra::Vector3::new(0.065175272524356842,-0.043763596564531326,-0.018328730016946793),
                prev_kf_imu_rotation: nalgebra::Matrix3::new(
                    0.030734062194824219 ,  0.99915772676467896 ,-0.027192717418074608,
                    -0.99580514430999756 , 0.028262436389923096, -0.087026521563529968,
                    -0.086184673011302948 , 0.029753334820270538 ,  0.99583476781845093,
                ),
                prev_kf_imu_position: nalgebra::Vector3::new(0.062667049467563629,-0.092444159090518951,-0.039206214249134064),
                updated_delta_velocity: nalgebra::Vector3::new(2.399268627166748,0.052245650440454483,-0.87505722045898438),
                d_t: 0.25
            },
            KeyFrameDummy {
                id: 51,
                imu_position: nalgebra::Vector3::new(0.066005676984786987,-0.0093048177659511566,-0.0087219346314668655),
                prev_kf_imu_rotation: nalgebra::Matrix3::new(
                    0.019911229610443115 ,  0.99957579374313354 ,-0.021255053579807281,
                    -0.99942547082901001,  0.019316017627716064 ,-0.027850041165947914,
                    -0.027427662163972855 , 0.021797370165586472  , 0.99938613176345825,
                ),
                prev_kf_imu_position: nalgebra::Vector3::new(0.065175272524356842,-0.043763596564531326,-0.018328730016946793),
                updated_delta_velocity: nalgebra::Vector3::new(2.4406106472015381,0.021383216604590416, -1.0072472095489502),
                d_t: 0.25
            },
            KeyFrameDummy {
                id: 52,
                imu_position: nalgebra::Vector3::new(0.065249107778072357,0.0037395022809505463, -0.01129281148314476),
                prev_kf_imu_rotation: nalgebra::Matrix3::new(
                    0.03889918327331543,   0.99703055620193481, -0.066459648311138153,
                    -0.99853229522705078 , 0.041293740272521973 , 0.035044357180595398,
                    0.037684664130210876 , 0.064998909831047058 ,   0.9971734881401062,
                ),
                prev_kf_imu_position: nalgebra::Vector3::new(0.066005676984786987,-0.0093048177659511566,-0.0087219346314668655),
                updated_delta_velocity: nalgebra::Vector3::new( 2.3737087249755859,-0.055561721324920654,  -1.1735450029373169),
                d_t: 0.25
            },

        ];

        for kf in keyframes.iter() {
            let velocity = {

                dir_g = dir_g - (kf.prev_kf_imu_rotation * kf.updated_delta_velocity);

                println!("... current imu pos: {:?}", kf.imu_position);
                println!("... prev imu pos: {:?}", kf.prev_kf_imu_position);
                println!("... d t: {}", kf.d_t);
                println!("= velocity top: {:?}", kf.imu_position - kf.prev_kf_imu_position);

                (
                    DVVector3::new((kf.imu_position - kf.prev_kf_imu_position) / kf.d_t),
                )
            };
            println!("Set KF velocity {} {:?}", kf.id,  velocity);
        }

        dir_g = dir_g / dir_g.norm();
        let gi = Vector3::new(0.0, 0.0, -1.0);
        let v = gi.cross(&dir_g);
        let nv = v.norm();
        let cosg = gi.dot(&dir_g);
        let ang = cosg.acos();
        let vzg = v * ang / nv;

        rwg = {
            let unit_quat = group_exp(& nalgebra::Vector3::new(vzg.x, vzg.y, vzg.z));
            DVMatrix3::new(* unit_quat.to_rotation_matrix().matrix())
        };


        assert!(
            (*rwg -
            nalgebra::Matrix3::new(
                0.99592792987823486 , 0.075498953461647034 , 0.049268767237663269,
                0.075498953461647034  , -0.3998115062713623   , -0.913482666015625,
                -0.049268767237663269  ,   0.913482666015625 , -0.40388357639312744,
            )).abs() <
            nalgebra::Matrix3::new(
                1e-5, 1e-5, 1e-5,
                1e-5, 1e-5, 1e-5,
                1e-5, 1e-5, 1e-5
            )
        );

    }

    // #[test]
    fn test_inertial_gba() {
        let mut system_config = env::current_dir().unwrap();
        system_config.push("orbslam_config.yaml");
        let mut dataset_config = env::current_dir().unwrap();
        dataset_config.push("config_datasets/EUROC.yaml");
        let _ = load_config(
            &system_config.into_os_string().into_string().unwrap(),
            &dataset_config.into_os_string().into_string().unwrap()
        ).expect("Could not load config");

        let camera_param = [458.654, 457.296, 367.215, 248.375];
        let prior_a = 10000000000.0;
        let prior_g = 100.0;
        let max_kf_id = 64;

        let mut optimizer = g2o::ffi::new_sparse_optimizer(5, camera_param, 1e5);

        struct KeyFrameDummy {
            id: Id,
            pose: Pose,
            imu_rotation: nalgebra::Matrix3<f64>,
            imu_position: nalgebra::Vector3<f64>,
            velocity: nalgebra::Vector3<f64>,
            prev_kf_id: Id,
            imu_preintegrated: Option<ImuPreIntegrated>,
        }
        let calib = ImuCalib::new();
        let keyframes = vec![
            KeyFrameDummy {
                id: 59,
                prev_kf_id: 58,
                imu_position: Vector3::new(-0.098112113773822784, 0.060175135731697083,-0.2106126993894577),
                velocity: Vector3::new(-0.099902123212814331, 0.00030876696109771729,0.00088042020797729492),
                imu_rotation: Matrix3::new(
                    0.034043729305267334,   0.99935483932495117, -0.011448211967945099,
                    -0.99856382608413696,  0.033538162708282471, -0.041781298816204071,
                    -0.041370388120412827,  0.012854164466261864,   0.99906116724014282,
                ), 
                pose: Pose::new(
                    Vector3::new(0.15927127003669739, -0.073142148554325104,0.2064451277256012),
                    Matrix3::new(
                        0.9997134804725647 , 0.019756156951189041, -0.013516758568584919,
                        -0.019125277176499367 ,  0.99878984689712524 , 0.045310515910387039,
                        0.014395562931895256, -0.045039020478725433 ,  0.99888151884078979
                    ),
                ),
                imu_preintegrated: Some(ImuPreIntegrated {
                    d_t: 0.25,
                    d_v: Vector3::new(1.6956512928009033, -0.075809411704540253, -1.7529716491699219),
                    d_p: Vector3::new(0.21129941940307617, -0.0099749276414513588, -0.21853739023208618),
                    avg_a: Vector3::new(6.7826051712036133, -0.3032376766204834, -7.0118865966796875),
                    avg_w: Vector3::new(0.0061226221732795238, 0.016859913244843483, 0.0043633473105728626),
                    d_r: Matrix3::new(   0.99999058246612549, -0.0010348204523324966 , 0.0042294040322303772,
                    0.0010413946583867073  ,  0.99999827146530151, -0.0015518249711021781,
                    -0.0042278128676116467,  0.0015562203479930758  ,  0.99998992681503296),
                    jrg: Matrix3::new(   -0.24998138844966888 , -0.0007502017542719841 ,  0.0026820385828614235,
                    0.00074271939229220152 ,   -0.24999725818634033, -0.00067408749600872397,
                    -0.002684498205780983 , 0.00066465087002143264 ,   -0.24998146295547485),
                    jvg: Matrix3::new(-0.00046952083357609808 ,    0.21532353758811951,  -0.0086884759366512299,
                    -0.21687059104442596 ,-0.00031183563987724483 ,   -0.20675887167453766,
                    0.0084014628082513809  ,   0.20838955044746399 , 2.4199249310186133e-05),
                    jva: Matrix3::new(   -0.24999114871025085, -0.00049127743113785982 ,  0.0016359955770894885,
                    0.00048916932428255677 ,   -0.24999865889549255, -0.00028730911435559392,
                    -0.0016369990771636367,  0.00028271466726437211  ,  -0.24999134242534637),
                    jpg: Matrix3::new(-3.3414031349821016e-05 ,   0.017732653766870499 ,-0.00090810318943113089,
                    -0.017852375283837318 ,-2.8096139430999756e-05  , -0.017247453331947327,
                    0.00088109512580558658  ,  0.017372237518429756 ,-7.8617076724185608e-06),
                    jpa: Matrix3::new(  -0.031248828396201134, -5.7042499975068495e-05 , 0.00022854720009490848,
                    5.6897206377470866e-05 ,    -0.0312498789280653, -1.4040542737348005e-05,
                    -0.00022862668265588582 , 1.3485551789926831e-05  , -0.031248869374394417),

                    b: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    bu: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },

                    c: SMatrix::<f64, 15, 15>::from_row_slice(&[7.2250005977991805e-09,1.8698017391344715e-17,4.135132461306484e-17,-7.554266240328289e-12,6.1973151055383369e-09,-2.602391357964251e-10,-6.4453005649625639e-13,5.1034948489458998e-10,-2.6739015515642173e-11,0.0,0.0,0.0,0.0,0.0,0.0
,1.8695515997172355e-17,7.224993048282613e-09,7.5819202893043106e-17,-6.2224239094632594e-09,2.9310549213429349e-12,-6.021737330996757e-09,-5.1243492782404587e-10,2.508014683520049e-13,-5.0198822876268423e-10,0.0,0.0,0.0,0.0,0.0,0.0
,4.4391454900936082e-17,7.5380208215793863e-17,7.2249974891747115e-09,2.6362328986451189e-10,6.0482729935529278e-09,8.2699246756190448e-12,2.7011344549965344e-11,5.0417897634602582e-10,6.6802699439857949e-13,0.0,0.0,0.0,0.0,0.0,0.0,
-7.5542679750517649e-12,-6.222425241730889e-09,2.6362334537566312e-10,1.0072263876281795e-06,3.0394053940341337e-10,7.0013257413847896e-09,1.2566938778491021e-07,2.8877272101324181e-11,6.5509170310562581e-10,0.0,0.0,0.0,0.0,0.0,0.0
,6.1973151055383369e-09,2.9310503676938104e-12,6.0482712171960884e-09,3.0394053940341337e-10,1.0140090580534888e-06,-3.1298524882927836e-10,3.2861876414491675e-11,1.2630474088837218e-07,-3.3818500083659941e-11,0.0,0.0,0.0,0.0,0.0,0.0,
-2.6023908028527387e-10,-6.021737330996757e-09,8.2699177367251409e-12,7.0013235209387403e-09,-3.1298519331812713e-10,1.0068102938021184e-06,6.4929966958615637e-10,-2.9442656646061494e-11,1.2563828022393864e-07,0.0,0.0,0.0,0.0,0.0,0.0,
-6.4452956860527877e-13,-5.1243487231289464e-10,2.7011348019412296e-11,1.2566940199576493e-07,3.2861869475597771e-11,6.4929978060845883e-10,2.0897383379292478e-08,3.2226894763898173e-12,6.4740782179661949e-11,0.0,0.0,0.0,0.0,0.0,0.0
,5.1034959591689244e-10,2.5080106177619022e-13,5.0417886532372336e-10,2.8877273836047657e-11,1.2630472667751746e-07,-2.9442667054402349e-11,3.2226892595493828e-12,2.0960754909538082e-08,-3.2850291497438233e-12,0.0,0.0,0.0,0.0,0.0,0.0,
-2.6739017250365649e-11,-5.0198822876268423e-10,6.6802656071771049e-13,6.5509164759447458e-10,-3.3818496614212989e-11,1.2563828022393864e-07,6.4740789118555853e-11,-3.2850284992225198e-12,2.0894937335924624e-08,0.0,0.0,0.0,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,9.402204015351856e-11,0.0,0.0,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,9.402204015351856e-11,0.0,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,9.402204015351856e-11,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.2499993974633981e-06,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.2499993974633981e-06,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.2499993974633981e-06]),
                    info: SMatrix::<f64, 15, 15>::zeros(),
                    nga_walk: calib.cov_walk,
                    nga: calib.cov,
                    d_b: SMatrix::<f64, 6, 1>::zeros(),
                    measurements: vec![],
                }),
                
            },
            KeyFrameDummy {
                id: 56,
                prev_kf_id: 55,
                imu_position: Vector3::new(0.048577740788459778, -0.035978935658931732,-0.063918277621269226),
                velocity: Vector3::new(-0.21128073334693909, 0.18306636810302734,-0.19490495324134827),
                imu_rotation: Matrix3::new(
                0.030418574810028076  , 0.99922090768814087, -0.025147352367639542,
                -0.99927628040313721,  0.029826045036315918 ,-0.023610638454556465,
                -0.022842194885015488  ,0.025847353041172028  ,  0.9994049072265625,
                ), 
                pose: Pose::new(
                    nalgebra::Vector3::new(0.01719433069229126, 0.017735203728079796,0.054836791008710861),
                    nalgebra::Matrix3::new(
                        0.99987882375717163 ,   0.015566722489893436, -0.00026274914853274822,
                        -0.015553968027234077 ,    0.99951493740081787  ,  0.026980290189385414,
                        0.00068261637352406979 ,  -0.026972932741045952 ,    0.99963593482971191
                    ),
                ),
                imu_preintegrated: Some(ImuPreIntegrated {
                    b: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    bu: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    c: SMatrix::<f64, 15, 15>::from_row_slice(&[
                        1.1560000068300269e-08,1.6119056838584037e-16,9.3180109293975453e-17,-8.0691520132347705e-10,1.6645604006271242e-08,-1.1890339823850127e-09,-1.0719763965383322e-10,2.2032062840793287e-09,-1.6840526195771588e-10,0.0,0.0,0.0,0.0,0.0,0.0
,1.6227739106650644e-16,1.1559994739229751e-08,4.715837735864841e-18,-1.7146719599736571e-08,-8.133311246716346e-10,-1.3637133200461449e-08,-2.2716402092726184e-09,-1.0785448228967098e-10,-1.8629915388146401e-09,0.0,0.0,0.0,0.0,0.0,0.0
,8.0310092170046601e-17,4.60768304359292e-18,1.1559994739229751e-08,5.0322718214701467e-10,1.4280495896912271e-08,-6.7430561134784739e-11,7.4955597284542819e-11,1.9486294799975212e-09,-9.4254135746263401e-12,0.0,0.0,0.0,0.0,0.0,0.0,
-8.0691509030117459e-10,-1.7146714270666052e-08,5.0322696010240975e-10,1.6342319213435985e-06,9.2829932629712175e-10,2.7461034335374279e-08,3.2511118774891656e-07,1.4692579097808078e-10,4.2288323953698637e-09,0.0,0.0,0.0,0.0,0.0,0.0
,1.6645596900843884e-08,-8.1333118018278583e-10,1.4280493232377012e-08,9.2829927078597052e-10,1.6562582914048107e-06,-1.1530311150309558e-09,1.5817684662078335e-10,3.2852113918124815e-07,-1.9515300486716569e-10,0.0,0.0,0.0,0.0,0.0,0.0,
-1.1890335382958028e-09,-1.3637131424104609e-08,-6.7430588890360355e-11,2.7461036111731119e-08,-1.1530317811647706e-09,1.6221064242927241e-06,4.1214494039820693e-09,-1.7672560637116419e-10,3.2342401823370892e-07,0.0,0.0,0.0,0.0,0.0,0.0,
-1.0719761189825761e-10,-2.2716388770049889e-09,7.4955548712285491e-11,3.2511127301404485e-07,1.5817680498741993e-10,4.1214494039820693e-09,8.6144851252356602e-08,2.7020949713851827e-11,6.7802768954905446e-10,0.0,0.0,0.0,0.0,0.0,0.0
,2.2032056179455139e-09,-1.078545100452466e-10,1.9486285918191015e-09,1.4692587424480763e-10,3.2852113918124815e-07,-1.7672555086001296e-10,2.7020953183298779e-11,8.6709171398524632e-08,-3.2258001825269389e-11,0.0,0.0,0.0,0.0,0.0,0.0,
-1.6840516481320122e-10,-1.862991760859245e-09,-9.4254144419880781e-12,4.2288346158159129e-09,-1.9515292160043884e-10,3.2342407507712778e-07,6.7802780057135692e-10,-3.2258001825269389e-11,8.5897063684114983e-08,0.0,0.0,0.0,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.5043524759228433e-10,0.0,0.0,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.5043524759228433e-10,0.0,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.5043524759228433e-10,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,3.5999987630930264e-06,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,3.5999987630930264e-06,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,3.5999987630930264e-06

]),
                    info: SMatrix::<f64, 15, 15>::zeros(),
                    nga_walk: calib.cov_walk,
                    nga: calib.cov,
                    d_b: SMatrix::<f64, 6, 1>::zeros(),
                    measurements: vec![],

                    d_t: 0.40000009536743164,
                    d_v: Vector3::new(2.5087361335754395, -0.12383084744215012, -3.0122950077056885),
                    d_p: Vector3::new(0.52395462989807129, -0.029741039499640465, -0.60348314046859741),
                    avg_a: Vector3::new(6.2718386650085449, -0.30957695841789246, -7.5307354927062988),
                    avg_w: Vector3::new(-0.0034775815438479185, 0.0888676717877388, 0.11561498045921326),
                    d_r: Matrix3::new(   0.99830836057662964 , -0.045934088528156281 ,  0.035645630210638046,
                    0.045839689671993256 ,   0.99894285202026367 , 0.0034627297427505255,
                    -0.035767048597335815 ,-0.0018228645203635097  ,  0.99935859441757202),
                    jrg: Matrix3::new(  -0.39950630068778992, -0.0072630848735570908 ,  0.014891169033944607,
                    0.0072091361507773399 ,  -0.39989858865737915, -0.0014692998956888914,
                    -0.014911508187651634 , 0.0011019917437806726  , -0.39960187673568726),
                    jvg: Matrix3::new( 0.011961978860199451 ,  0.59382140636444092, -0.016517380252480507,
                    -0.60037195682525635,  0.014618063345551491 , -0.46465286612510681,
                    0.029091468080878258 ,  0.47275155782699585 ,0.0020594398956745863),
                    jva: Matrix3::new(   -0.39969712495803833 ,   0.011042395606637001 , 0.00077855406561866403,
                    -0.011048523709177971  ,  -0.39980760216712952 , -0.0021602087654173374,
                    -0.00071539293276146054  , 0.0020854845643043518   ,  -0.3998769223690033),
                    jpg: Matrix3::new( 0.0012374005746096373,   0.078676991164684296 ,-0.0025227388832718134,
                    -0.079852774739265442,  0.0015797412488609552 , -0.063172444701194763,
                    0.00390401273034513,   0.064610116183757782 ,0.00022525942767970264),
                    jpa: Matrix3::new(  -0.079956762492656708  , 0.0016227173618972301 ,  0.0011304636718705297,
                    -0.0016282328870147467  , -0.079976305365562439 ,-0.00039395259227603674,
                    -0.0011204539332538843 , 0.00040809539495967329 ,  -0.079978138208389282),
                }),

            },
            KeyFrameDummy {
                id: 57,
                prev_kf_id: 56,
                imu_position: Vector3::new(-0.0042424425482749939, 0.009787658229470253,-0.11264451593160629),
                velocity: Vector3::new(-0.20775920152664185, 0.092365674674510956,-0.27579835057258606),
                imu_rotation: Matrix3::new(
                0.046421289443969727 ,  0.99866610765457153, -0.022608058527112007,
                -0.99849873781204224,  0.045731008052825928, -0.030149824917316437,
                -0.029075717553496361,  0.023973710834980011 ,  0.99928969144821167,
                ), 
                pose: Pose::new(
                    nalgebra::Vector3::new(0.068902820348739624, -0.026879582554101944,0.1048654317855835),
                    nalgebra::Matrix3::new(
                        0.9994966983795166 ,  0.031644832342863083 ,-0.0022252534981817007,
                        -0.03155367448925972 ,    0.9989510178565979 ,   0.03318459540605545,
                        0.0032730400562286377, -0.033097676932811737,    0.99944674968719482
                    ),
                ),
                imu_preintegrated: Some(ImuPreIntegrated {
                    b: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    bu: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    c: SMatrix::<f64, 15, 15>::from_row_slice(&[
                        7.2250001537099706e-09,-6.3816249722082138e-17,-2.4009930575602006e-19,-2.3262095028009355e-10,6.5216116951205549e-09,-5.3064752592035802e-10,-1.9163294215363003e-11,5.338842701263502e-10,-5.343563092008452e-11,0.0,0.0,0.0,0.0,0.0,0.0,
-6.2300113686056144e-17,7.2249992655315509e-09,6.0380505417006384e-17,-6.5932579396132951e-09,-2.5448718132814463e-10,-5.7963469579647153e-09,-5.3975379721293848e-10,-2.0817307946896513e-11,-4.7084947052411508e-10,0.0,0.0,0.0,0.0,0.0,0.0,
-3.2555177796223937e-18,6.0383721495227991e-17,7.2249988214423411e-09,2.977456892150343e-10,5.8890394782906696e-09,-3.1771481279196934e-11,3.4490493794336885e-11,4.7878684350521894e-10,-2.7049222237063297e-12,0.0,0.0,0.0,0.0,0.0,0.0,
-2.3262096415788136e-10,-6.5932566073456655e-09,2.9774571697060992e-10,1.0081040500153904e-06,3.8733874441199134e-10,7.1062915552033701e-09,1.2574641061746661e-07,3.6949044518452823e-11,6.4881428007979025e-10,0.0,0.0,0.0,0.0,0.0,0.0
,6.5216130273881845e-09,-2.544871258169934e-10,5.8890403664690893e-09,3.8733846685623519e-10,1.0143297686227015e-06,-4.4074952021411207e-10,4.6576076329074567e-11,1.2631325319034659e-07,-5.3056451593258558e-11,0.0,0.0,0.0,0.0,0.0,0.0,
-5.3064747040920679e-10,-5.7963469579647153e-09,-3.1771481279196934e-11,7.1062919992925799e-09,-4.4074952021411207e-10,1.0062759656648268e-06,6.5296346107857062e-10,-4.23850711472884e-11,1.25572995557377e-07,0.0,0.0,0.0,0.0,0.0,0.0,
-1.9163292480639527e-11,-5.3975374170178725e-10,3.4490500733230789e-11,1.2574645325003075e-07,4.6576083267968471e-11,6.5296335005626815e-10,2.0904630915197231e-08,4.6315694335330448e-12,6.3593220966939867e-11,0.0,0.0,0.0,0.0,0.0,0.0
,5.3388432563750143e-10,-2.0817299273279133e-11,4.7878673248291648e-10,3.6949027171218063e-11,1.2631328161205602e-07,-4.2385078086182304e-11,4.6315672651286999e-12,2.0959653568297654e-08,-5.3208852254793548e-12,0.0,0.0,0.0,0.0,0.0,0.0,
-5.3435627450637568e-11,-4.7084941501296385e-10,-2.7049215731850262e-12,6.4881444661324394e-10,-5.3056451593258558e-11,1.2557296713566757e-07,6.3593227905833771e-11,-5.3208856591602238e-12,2.0887043206130329e-08,0.0,0.0,0.0,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,9.402204015351856e-11,0.0,0.0,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,9.402204015351856e-11,0.0,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,9.402204015351856e-11,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.2499993974633981e-06,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.2499993974633981e-06,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.2499993974633981e-06

]),
                    info: SMatrix::<f64, 15, 15>::zeros(),
                    nga_walk: calib.cov_walk,
                    nga: calib.cov,
                    d_b: SMatrix::<f64, 6, 1>::zeros(),
                    measurements: vec![],
                    d_t: 0.25,
                    d_v: Vector3::new(1.6086376905441284, -0.1235460638999939, -1.849172830581665),
                    d_p: Vector3::new(0.1970532089471817, -0.019179657101631165, -0.22944000363349915),
                    avg_a: Vector3::new(6.4345502853393555, -0.49418431520462036, -7.3966913223266602),
                    avg_w: Vector3::new(-0.017320660874247551, 0.048171110451221466, 0.13879558444023132),
                    d_r: Matrix3::new(   0.99932682514190674 , -0.034722886979579926 ,  0.011851358227431774,
                    0.034668121486902237  ,  0.99938750267028809 , 0.0047956244088709354,
                    -0.012010280042886734, -0.0043814084492623806,    0.99991822242736816),
                    jrg: Matrix3::new(  -0.24993471801280975, -0.0038057055789977312 , 0.0031618522480130196,
                    0.0038230519276112318  ,  -0.2499532550573349 , 0.0012384650763124228,
                    -0.003140660235658288, -0.0012906967895105481,    -0.2499745786190033),
                    jvg: Matrix3::new(  0.0030020684935152531  ,   0.22818835079669952 ,  -0.011643378995358944,
                        -0.2285521924495697 ,  0.0028113140724599361 ,   -0.20068939030170441,
                    0.014068346470594406  ,    0.2009347528219223, -0.00023584795417264104),
                    jva: Matrix3::new(   -0.24993796646595001 ,  0.0047737718559801579 , 0.00018373729835730046,
                    -0.0047723720781505108  ,  -0.24993972480297089 , 0.00016059746849350631,
                    -0.00018524013285059482, -0.00016073403821792454 ,   -0.24999770522117615),
                    jpg: Matrix3::new( 0.00018480455037206411,      0.0186796635389328 , -0.0013023808132857084,
                    -0.018705371767282486,  0.00017014387412928045  , -0.016319377347826958,
                    0.0014476414071395993  ,  0.016334297135472298, -1.8684420865611173e-05),
                    jpa: Matrix3::new(  -0.031245904043316841 , 0.00040394949610345066 , 5.2753799536731094e-05,
                    -0.00040384603198617697  , -0.031246015802025795,  3.2913951145019382e-05,
                    -5.3227086027618498e-05 ,-3.1985662644729018e-05,   -0.031249845400452614),
                }),
            },
            KeyFrameDummy {
                id: 55,
                prev_kf_id: -1,
                imu_position: Vector3::new(0.065222904086112976, -0.020706389099359512,-0.0080546028912067413),
                velocity: Vector3::new(-0.0416128970682621, -0.038181357085704803,-0.13965915143489838),
                imu_rotation: Matrix3::new(
                0.014865398406982422  ,  0.9995572566986084, -0.025774437934160233,
                -0.99988096952438354 , 0.014967083930969238, 0.0037561894860118628,
                0.0041402950882911682,  0.025715531781315804 ,  0.99966073036193848
                ), 
                pose: Pose::new(
                    nalgebra::Vector3::new(0.0, 0.0,0.0),
                    nalgebra::Matrix3::new(
                        1.0, 0.0, 0.0,
                        0.0, 1.0, 0.0,
                        0.0, 0.0, 1.0
                    ),
                ),
                imu_preintegrated: None,


            },
            KeyFrameDummy {
                id: 61,
                prev_kf_id: 60,

                imu_position: Vector3::new(-0.12126803398132324, 0.058753222227096558,-0.19390058517456055),
                velocity: Vector3::new(0.59120118618011475, -0.085182100534439087,0.071317076683044434),
                imu_rotation: Matrix3::new(
                0.029942095279693604 ,  0.99888253211975098 ,-0.036568440496921539,
                -0.99816977977752686  ,0.027957558631896973, -0.053624343127012253,
                -0.052542053163051605 , 0.038107138127088547 ,  0.99789136648178101,
                ), 
                pose: Pose::new(
                    nalgebra::Vector3::new(0.18786591291427612, -0.070167981088161469,0.18756633996963501),
                    nalgebra::Matrix3::new(
                        0.99982786178588867,  0.014489148743450642 , 0.011589112691581249,
                        -0.015125547535717487 ,  0.99826788902282715,  0.056854415684938431,
                        -0.010745267383754253, -0.057019922882318497,   0.99831521511077881
                    ),
                ),
                imu_preintegrated: Some(ImuPreIntegrated {
                    b: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    bu: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    c: SMatrix::<f64, 15, 15>::from_row_slice(&[
                        7.2249912719257736e-09,3.971716975596223e-17,-4.0133546006541822e-18,-1.0751145806953133e-10,6.3071663447544779e-09,-7.7470189985273663e-11,-8.9425879895577154e-12,5.2004700545893456e-10,-1.9268073248035478e-11,0.0,0.0,0.0,0.0,0.0,0.0
,3.8632530832113297e-17,7.2249966009962918e-09,2.3778750965186298e-17,-6.342935954251061e-09,-8.5149269579698483e-11,-5.8900084809465625e-09,-5.2294857333379241e-10,-7.0202732516122524e-12,-4.8559251064617115e-10,0.0,0.0,0.0,0.0,0.0,0.0,
-3.6324751517010779e-18,2.3615908881076659e-17,7.2250001537099706e-09,9.314051266362533e-13,5.9291207499256871e-09,2.1883793388521866e-11,1.295622376745742e-11,4.8903581184589484e-10,1.7263000924583327e-12,0.0,0.0,0.0,0.0,0.0,0.0,
-1.0751145113063743e-10,-6.3429363983402709e-09,9.3145705992031536e-13,1.0075021918964921e-06,1.8165514231727187e-11,6.9650689660250009e-09,1.256953652273296e-07,3.8952252881530036e-12,6.4660182763631724e-10,0.0,0.0,0.0,0.0,0.0,0.0
,6.3071672329328976e-09,-8.5149304274168003e-11,5.9291220821933166e-09,1.8165427495553388e-11,1.0139674486708827e-06,-1.9473322260266102e-11,1.6231307964353903e-11,1.2629577383904689e-07,-1.7461842735655431e-11,0.0,0.0,0.0,0.0,0.0,0.0,
-7.7470266313106606e-11,-5.8900080368573526e-09,2.1883802062139246e-11,6.9650676337573714e-09,-1.9473379506140809e-11,1.0064692332889535e-06,6.4585597980837406e-10,-4.1586404458948678e-12,1.2560086304347351e-07,0.0,0.0,0.0,0.0,0.0,0.0,
-8.9425923263664053e-12,-5.2294851782264118e-10,1.2956233308436538e-11,1.2569533680562017e-07,1.6231309699077379e-11,6.4585581327492037e-10,2.0899992847489557e-08,1.7693681806166262e-12,6.3963549734591396e-11,0.0,0.0,0.0,0.0,0.0,0.0
,5.2004722750353949e-10,-7.0202741189739903e-12,4.8903586735704607e-10,3.8952183492590997e-12,1.262957880499016e-07,-4.1586430479800818e-12,1.7693674216751054e-12,2.0959490143468429e-08,-1.8980732784112941e-12,0.0,0.0,0.0,0.0,0.0,0.0
,-1.926807671748243e-11,-4.8559262166847361e-10,1.72630020087855e-12,6.4660182763631724e-10,-1.7461839266208479e-11,1.2560089146518294e-07,6.3963577490167012e-11,-1.8980730615708596e-12,2.0890873031476076e-08,0.0,0.0,0.0,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,9.402204015351856e-11,0.0,0.0,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,9.402204015351856e-11,0.0,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,9.402204015351856e-11,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.2499993974633981e-06,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.2499993974633981e-06,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.2499993974633981e-06

]),
                    info: SMatrix::<f64, 15, 15>::zeros(),
                    nga_walk: calib.cov_walk,
                    nga: calib.cov,
                    d_b: SMatrix::<f64, 6, 1>::zeros(),
                    measurements: vec![],
                    d_t: 0.25,
                    d_v: Vector3::new(1.6688470840454102, -0.02859133668243885, -1.7850308418273926),
                    d_p: Vector3::new(0.209215447306633, -0.0078545110300183296, -0.22228606045246124),
                    avg_a: Vector3::new(6.6753888130187988, -0.11436530202627182, -7.1401233673095703),
                    avg_w: Vector3::new(0.014967937953770161, 0.024378761649131775, 0.067809537053108215),
                    d_r: Matrix3::new(   0.99983769655227661 , -0.016945790499448776 , 0.0061087803915143013,
                    0.016968714073300362 ,   0.99984920024871826, -0.0036917342804372311,
                    -0.0060452963225543499,  0.0037947909440845251  ,  0.99997460842132568),
                    jrg: Matrix3::new(   -0.24998375773429871 ,   -0.00236546341329813 , 0.00082655961159616709,
                    0.0023638156708329916  ,  -0.24998508393764496 ,-0.00029246613848954439,
                    -0.00083113100845366716 , 0.00028222092078067362 ,   -0.24999774992465973),
                    jvg: Matrix3::new( 0.00098155124578624964 ,    0.21951133012771606 , 0.00039999300497584045,
                    -0.21916802227497101  , 0.0006337821832858026   , -0.20418860018253326,
                    0.00014001847011968493 ,    0.20383866131305695, -0.00035809687688015401),
                    jva: Matrix3::new(   -0.24998870491981506  , 0.0018298987997695804 ,-0.00068032316630706191,
                    -0.0018323176773265004 ,   -0.24998892843723297,  0.00063504948047921062,
                    0.00067376886727288365, -0.00064239359926432371,     -0.2499975711107254),
                    jpg: Matrix3::new( 5.6475946621503681e-05 ,   0.018098963424563408, -0.0004036168975289911,
                    -0.018080336973071098, 3.5783508792519569e-05  , -0.016831906512379646,
                    0.00043362894211895764  ,   0.01681104488670826 ,-2.0353803847683594e-05),
                    jpa: Matrix3::new(  -0.031249374151229858 , 0.00013758808199781924,-5.0920712965307757e-05,
                    -0.0001377404696540907 ,   -0.03124937042593956 , 5.2675415645353496e-05,
                    5.0508013373473659e-05,  -5.308810796122998e-05,   -0.031249845400452614),
                }),
            },
            KeyFrameDummy {
                id: 58,
                prev_kf_id: 57,
                imu_position: Vector3::new(-0.056182242929935455, 0.032879076898097992,-0.18159410357475281),
                velocity: Vector3::new(-0.16771948337554932, 0.10918423533439636,-0.11607438325881958),
                imu_rotation: Matrix3::new(
                0.051454484462738037  ,  0.99864137172698975 ,-0.0082493387162685394,
                -0.99779510498046875 ,  0.051060616970062256 , -0.042401757091283798,
                -0.041922926902770996 ,   0.01041291281580925,    0.99906659126281738,
                ), 
                pose: Pose::new(
                    nalgebra::Vector3::new(0.11723335832357407, -0.047259625047445297,0.17580331861972809),
                    nalgebra::Matrix3::new(
                        0.99917662143707275 , 0.037298321723937988 ,-0.015965279191732407,
                        -0.036532659083604813 ,  0.99828118085861206 , 0.045826464891433716,
                        0.017647087574005127 ,-0.045205481350421906,   0.99882185459136963
                    ),
                ),
                imu_preintegrated: Some(ImuPreIntegrated {
                    b: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    bu: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    c: SMatrix::<f64, 15, 15>::from_row_slice(&[
                        7.2249983773531312e-09,-1.7514787141157832e-16,-1.2178148701210719e-16,-1.5691964394548563e-10,6.200963742486465e-09,-4.2607661843163669e-10,-1.3036864990323416e-11,5.1832604874846311e-10,-3.1455005267133629e-11,0.0,0.0,0.0,0.0,0.0,0.0,
-1.7796661177158342e-16,7.2249992655315509e-09,2.1065288528718782e-16,-6.3112137738130514e-09,-2.3173649110752592e-10,-5.5018891664815328e-09,-5.274654046871774e-10,-1.9357232830530258e-11,-4.5909928636511665e-10,0.0,0.0,0.0,0.0,0.0,0.0,
-1.2123626249187144e-16,2.1217050363087151e-16,7.2249979332639214e-09,2.0098382680355797e-10,5.6282916105487857e-09,-8.6766101248247907e-11,1.2660839390776779e-11,4.6956416532850653e-10,-7.1615807901992401e-12,0.0,0.0,0.0,0.0,0.0,0.0,
-1.5691965782327344e-10,-6.3112128856346317e-09,2.0098378517019455e-10,1.0074862757392111e-06,2.9097474429917725e-10,6.5226517520500238e-09,1.2570417595725303e-07,2.6853403181648083e-11,6.1434257681014515e-10,0.0,0.0,0.0,0.0,0.0,0.0
,6.2009624102188354e-09,-2.3173649110752592e-10,5.6282924987272054e-09,2.9097457776572355e-10,1.0131657290912699e-06,-3.3319433323519831e-10,2.3381132099875579e-11,1.262396978063407e-07,-2.6745394093863339e-11,0.0,0.0,0.0,0.0,0.0,0.0,
-4.2607675720951477e-10,-5.5018878342139033e-09,-8.6766149820505234e-11,6.5226508638716041e-09,-3.331943054796227e-10,1.0057099188998109e-06,6.1417726460177846e-10,-3.0729679217911254e-11,1.255378521136663e-07,0.0,0.0,0.0,0.0,0.0,0.0,
-1.3036868459770368e-11,-5.2746534917602617e-10,1.2660841125500255e-11,1.2570417595725303e-07,2.3381130365152103e-11,6.1417743113523215e-10,2.0901859798527767e-08,2.3525519639994164e-12,6.1749501345520486e-11,0.0,0.0,0.0,0.0,0.0,0.0
,5.1832599323731188e-10,-1.9357234565253734e-11,4.69564276350809e-10,2.6853392773307228e-11,1.2623971201719542e-07,-3.0729686156805158e-11,2.3525517471589819e-12,2.0955829072022425e-08,-2.6833461667929992e-12,0.0,0.0,0.0,0.0,0.0,0.0,
-3.1455008736580581e-11,-4.5909920309838981e-10,-7.1615833922844541e-12,6.1434246578784268e-10,-2.6745390624416387e-11,1.2553788053537573e-07,6.1749487467732678e-11,-2.6833446489099577e-12,2.0885428497763314e-08,0.0,0.0,0.0,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,9.402204015351856e-11,0.0,0.0,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,9.402204015351856e-11,0.0,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,9.402204015351856e-11,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.2499993974633981e-06,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.2499993974633981e-06,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.2499993974633981e-06

]),
                    info: SMatrix::<f64, 15, 15>::zeros(),
                    nga_walk: calib.cov_walk,
                    nga: calib.cov,
                    d_b: SMatrix::<f64, 6, 1>::zeros(),
                    measurements: vec![],
                    d_t: 0.25,
                    d_v: Vector3::new(1.5910439491271973, -0.081674665212631226, -1.8056818246841431),
                    d_p: Vector3::new(0.20308420062065125, -0.010039024986326694, -0.22858396172523499),
                    avg_a: Vector3::new(6.3641757965087891, -0.32669863104820251, -7.2227272987365723),
                    avg_w: Vector3::new(-0.05905492976307869, 0.075705349445343018, 0.096111804246902466),
                    d_r: Matrix3::new(  0.99952882528305054 , -0.02425282821059227 , 0.018807169049978256,
                    0.023977234959602356  ,  0.9996037483215332 , 0.014740114100277424,
                    -0.019157223403453827 ,-0.014282231219112873 ,   0.9997144341468811),
                    jrg: Matrix3::new(   -0.24997325241565704,  -0.0022735949605703354 ,-0.00027300228248350322,
                    0.0022808902431279421 ,   -0.24997645616531372 , 0.00088201730977743864,
                    0.00029086298309266567 ,-0.00089299748651683331 ,   -0.24998810887336731),
                    jvg: Matrix3::new( 0.0023484420962631702  ,  0.21838414669036865, -0.0083165038377046585,
                    -0.2150837630033493  ,0.0037876260466873646 ,  -0.19427821040153503,
                    0.012069907039403915  ,   0.1905626505613327 ,  0.001797898905351758),
                    jva: Matrix3::new(  -0.24990649521350861 , 0.0037127258256077766, -0.0049487883225083351,
                    -0.003649495542049408 ,   -0.2499459981918335, -0.0027728790882974863,
                    0.0049990820698440075 , 0.0026853089220821857 ,  -0.24992476403713226),
                    jpg: Matrix3::new( 0.00014349038247019053 ,   0.018251920118927956, -0.00058230047579854727,
                    -0.018026048317551613,  0.00024167720403056592  , -0.016158422455191612,
                    0.00082270317943766713 ,    0.01590237207710743,  0.00011798178456956521),
                    jpa: Matrix3::new(  -0.031242081895470619 , 0.00031213057809509337 ,-0.00051016785437241197,
                    -0.00030656231683678925  ,   -0.0312461256980896, -0.00026173147489316761,
                    0.00051385251572355628,  0.00025467257364653051 ,  -0.031243089586496353),
                }),

            },
            KeyFrameDummy {
                id: 62,
                prev_kf_id: 61,
                imu_position: Vector3::new(0.026532270014286041, 0.037457697093486786,-0.17607131600379944),
                velocity: Vector3::new(1.6823946237564087, -0.43695101141929626,0.15727448463439941),
                imu_rotation: Matrix3::new(
                0.032068908214569092  , 0.99919164180755615 ,-0.024243852123618126,
                -0.99873870611190796 , 0.031097888946533203, -0.039422105997800827,
                -0.038636300712823868 , 0.025477500632405281  ,  0.9989284873008728,
                ), 
                pose: Pose::new(
                    nalgebra::Vector3::new(0.037897787988185883, -0.050138164311647415,0.16941444575786591),
                nalgebra::Matrix3::new(
                        0.9998508095741272  ,  0.017253490164875984, -0.00085494609083980322,
                        -0.017201155424118042 ,    0.99893707036972046  ,  0.042765188962221146,
                        0.0015918861608952284  , -0.042744103819131851,     0.99908477067947388
                    ),
                ),
                imu_preintegrated: Some(ImuPreIntegrated {
                    b: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    bu: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    c: SMatrix::<f64, 15, 15>::from_row_slice(&[
                        7.2249970450855017e-09,4.1980332603184863e-17,-4.2066346152000577e-17,-1.4968611072863069e-10,6.2606071438153776e-09,4.1590950128345128e-10,-1.2381390183946461e-11,5.182747009335742e-10,3.3009359134972271e-11,0.0,0.0,0.0,0.0,0.0,0.0
,4.2844680095021124e-17,7.2249974891747115e-09,-5.4309271036108079e-17,-6.2120895094608386e-09,-2.012291305808489e-10,-6.048565648342219e-09,-5.1431725545114659e-10,-1.6601641936175859e-11,-4.9444631722295185e-10,0.0,0.0,0.0,0.0,0.0,0.0,
-4.2594358698050326e-17,-5.4309734257251108e-17,7.2250014859776002e-09,-6.1405158735539089e-10,5.9911426930625566e-09,-5.9039571842500749e-11,-4.9266094676037042e-11,4.8972753630138754e-10,-4.8191008475417796e-12,0.0,0.0,0.0,0.0,0.0,0.0,
-1.4968609685084289e-10,-6.2120899535500484e-09,-6.1405164286654212e-10,1.0072803888760973e-06,-6.2131177980262464e-10,6.9902252874953774e-09,1.2567757323722617e-07,-5.67655193683958e-11,6.4381389108802978e-10,0.0,0.0,0.0,0.0,0.0,0.0
,6.2606093642614269e-09,-2.0122915833642452e-10,5.9911440253301862e-09,-6.2131150224686849e-10,1.0139879123016726e-06,6.4198407700999383e-10,-5.539396372156169e-11,1.2629453749468667e-07,5.7317570828496756e-11,0.0,0.0,0.0,0.0,0.0,0.0
,4.1590961230575374e-10,-6.0485652042530091e-09,-5.903959265918246e-11,6.9902248434061676e-09,6.4198424354344752e-10,1.0068217761727283e-06,6.4984484460239855e-10,5.9294735788029129e-11,1.2562713891384192e-07,0.0,0.0,0.0,0.0,0.0,0.0,
-1.2381391051308199e-11,-5.1431725545114659e-10,-4.9266084267696186e-11,1.2567754481551674e-07,-5.5393988007690353e-11,6.4984495562470102e-10,2.0898463404250833e-08,-5.3642069085257926e-12,6.3863747623571498e-11,0.0,0.0,0.0,0.0,0.0,0.0
,5.182745344001205e-10,-1.6601640201452383e-11,4.8972770283484124e-10,-5.6765505490607993e-11,1.2629453749468667e-07,5.9294735788029129e-11,-5.3642038727597097e-12,2.0959083357752206e-08,5.6068374769402407e-12,0.0,0.0,0.0,0.0,0.0,0.0
,3.3009369543313127e-11,-4.9444637273410308e-10,-4.8191012812226486e-12,6.4381378006572731e-10,5.7317567359049804e-11,1.2562716733555135e-07,6.3863747623571498e-11,5.6068374769402407e-12,2.0892811036787862e-08,0.0,0.0,0.0,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,9.402204015351856e-11,0.0,0.0,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,9.402204015351856e-11,0.0,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,9.402204015351856e-11,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.2499993974633981e-06,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.2499993974633981e-06,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.2499993974633981e-06

]),
                    info: SMatrix::<f64, 15, 15>::zeros(),
                    nga_walk: calib.cov_walk,
                    nga: calib.cov,
                    d_b: SMatrix::<f64, 6, 1>::zeros(),
                    measurements: vec![],
                    d_t: 0.25,
                    d_v: Vector3::new(1.693202018737793, 0.14225669205188751, -1.760756254196167),
                    d_p: Vector3::new(0.21015909314155579, 0.015917506068944931, -0.22058917582035065),
                    avg_a: Vector3::new(6.7728080749511719, 0.56902682781219482, -7.043025016784668),
                    avg_w: Vector3::new(-0.036945130676031113, -0.028986439108848572, 0.093542680144309998),
                    d_r: Matrix3::new(   0.99969983100891113 , -0.023358901962637901, -0.0073793670162558556,
                    0.02342570386826992 ,   0.99968409538269043,  0.0090976627543568611,
                    0.0071645253337919712,  -0.009267798624932766 ,   0.99993133544921875),
                    jrg: Matrix3::new(  -0.24996928870677948 , -0.003110246267169714 ,-0.0015499518485739827,
                    0.0030989767983555794,   -0.24996976554393768 , 0.0015230255667120218,
                    0.0015729432925581932, -0.0014994431985542178 ,  -0.24998871982097626),
                    jvg: Matrix3::new( 0.0015103247715160251,    0.21515600383281708  , 0.019654156640172005,
                    -0.21509608626365662 , 0.0018753550248220563  , -0.20900236070156097,
                    -0.017805662006139755  ,  0.20903836190700531 ,0.00034716096706688404),
                    jva: Matrix3::new(   -0.24997904896736145 ,  0.0026824669912457466,  0.00024126697098836303,
                    -0.0026849289424717426  ,  -0.24997811019420624, -0.00076525117037817836,
                    -0.00022890143736731261 , 0.00077179865911602974 ,   -0.24999688565731049),
                    jpg: Matrix3::new(9.2228510766290128e-05 ,  0.017814084887504578,  0.0015634441515430808,
                    -0.017801739275455475 ,0.00011349103442626074 ,  -0.01709291897714138,
                    -0.0014526359736919403 ,  0.017086323350667953, 1.8641032511368394e-05),
                    jpa: Matrix3::new(  -0.031248783692717552 , 0.00021657354955095798 ,-1.3367134670261294e-05,
                    -0.00021661960636265576 ,  -0.031248742714524269, -5.1822382374666631e-05,
                    1.3973844943393487e-05 , 5.1898874517064542e-05 ,  -0.031249864026904106),

                }),
            },
            KeyFrameDummy {
                id: 60,
                prev_kf_id: 59,
                imu_position: Vector3::new(-0.12308764457702637, 0.060252327471971512,-0.21039259433746338),
                velocity: Vector3::new(0.0072784423828125, -0.0059964209794998169,0.065968036651611328),
                imu_rotation: Matrix3::new(
                0.032686531543731689 ,  0.99891495704650879, -0.033174231648445129,
                -0.99818164110183716 , 0.030944645404815674, -0.051728200167417526,
                -0.050645507872104645 , 0.034804727882146835 ,  0.99811005592346191,
                ), 
                pose: Pose::new(
                    nalgebra::Vector3::new(0.1889861673116684, -0.071503564715385437,0.20442658662796021),
                    nalgebra::Matrix3::new(
                        0.99981361627578735 , 0.017425952479243279, 0.0083107268437743187,
                        -0.017856545746326447 ,  0.99833166599273682 , 0.054909493774175644,
                        -0.007340011652559042, -0.055047657340764999 ,  0.99845677614212036
                    ),
                ),
                imu_preintegrated: Some(ImuPreIntegrated {
                    b: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    bu: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    c: SMatrix::<f64, 15, 15>::from_row_slice(&[
                        7.2249979332639214e-09,8.0775814707248657e-17,8.938045184149067e-17,-1.1011914297087699e-10,6.1848548504883638e-09,-1.2856567199737157e-10,-9.1146968445032783e-12,5.0739656920484322e-10,-1.5631244562608337e-11,0.0,0.0,0.0,0.0,0.0,0.0
,8.0125041940851138e-17,7.2249926041934032e-09,1.0665249257485522e-16,-6.2752323337633698e-09,4.359002308412796e-12,-5.7488924731785573e-09,-5.1471688022886042e-10,3.6338130855045891e-13,-4.7184434137648168e-10,0.0,0.0,0.0,0.0,0.0,0.0
,9.0986657920056338e-17,1.0451137857265356e-16,7.2249983773531312e-09,1.4869122599847628e-10,5.8512639178331938e-09,1.1002902755574695e-10,1.7276943764521491e-11,4.8033005350944791e-10,8.9500039324175162e-12,0.0,0.0,0.0,0.0,0.0,0.0,
-1.1011910827640747e-10,-6.2752332219417895e-09,1.4869133702077875e-10,1.0073275689137517e-06,4.6334082404175803e-11,6.7135439429932831e-09,1.2567718954414886e-07,5.2545927678449011e-12,6.1966604070207154e-10,0.0,0.0,0.0,0.0,0.0,0.0
,6.1848552945775737e-09,4.3589953695188921e-12,5.8512634737439839e-09,4.6334026893024571e-11,1.0134789363291929e-06,-5.0750677965671898e-11,1.0275839207318782e-11,1.2624464318378159e-07,-1.1245926932745842e-11,0.0,0.0,0.0,0.0,0.0,0.0,
-1.2856560260843253e-10,-5.7488924731785573e-09,1.1002907612800428e-10,6.7135448311717028e-09,-5.0750733476823129e-11,1.0061519333248725e-06,6.2011251689142455e-10,-5.7725148445986196e-12,1.2556758122173051e-07,0.0,0.0,0.0,0.0,0.0,0.0,
-9.1146977118650163e-12,-5.1471693574001165e-10,1.7276950703415395e-11,1.2567721796585829e-07,1.0275841809403996e-11,6.2011229484681962e-10,2.0898145436376581e-08,1.1075538272967145e-12,6.113522188488929e-11,0.0,0.0,0.0,0.0,0.0,0.0
,5.0739668022714568e-10,3.633806038190468e-13,4.8032999799829668e-10,5.2545927678449011e-12,1.2624465739463631e-07,-5.7725235182159995e-12,1.1075545862382352e-12,2.0954018964403076e-08,-1.2153676502701938e-12,0.0,0.0,0.0,0.0,0.0,0.0,
-1.5631241093161385e-11,-4.718445634210866e-10,8.9500074018644682e-12,6.19666151724374e-10,-1.12459191264902e-11,1.2556758122173051e-07,6.1135228823783194e-11,-1.2153658071265006e-12,2.0887156892968051e-08,0.0,0.0,0.0,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,9.402204015351856e-11,0.0,0.0,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,9.402204015351856e-11,0.0,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,9.402204015351856e-11,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.2499993974633981e-06,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.2499993974633981e-06,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.2499993974633981e-06

]),
                    info: SMatrix::<f64, 15, 15>::zeros(),
                    nga_walk: calib.cov_walk,
                    nga: calib.cov,
                    d_b: SMatrix::<f64, 6, 1>::zeros(),
                    measurements: vec![],
                    d_t: 0.25,
                    d_v: Vector3::new(1.6193963289260864, -0.023786017671227455, -1.7749457359313965),
                    d_p: Vector3::new(0.20179295539855957, -0.0049147214740514755, -0.22207050025463104),
                    avg_a: Vector3::new(6.4775853157043457, -0.095144070684909821, -7.0997829437255859),
                    avg_w: Vector3::new(0.077269218862056732, 0.064228110015392303, 0.069387324154376984),
                    d_r: Matrix3::new(  0.99972134828567505, -0.017159627750515938 , 0.016209181398153305,
                    0.017469936981797218  , 0.99966281652450562 ,-0.019210478290915489,
                    -0.015874072909355164 , 0.019488301128149033 ,  0.99968421459197998),
                    jrg: Matrix3::new(  -0.24998526275157928, -0.0017558636609464884 , 0.0011185373878106475,
                    0.001740884967148304 ,  -0.24998007714748383 ,-0.0017351005226373672,
                    -0.0011382665252313018,  0.0017212467500939965 ,  -0.24998404085636139),
                    jvg: Matrix3::new(   0.001629388309083879  ,   0.21720787882804871 , -0.0029074761550873518,
                    -0.21544213593006134 ,-0.00018657678447198123  ,  -0.20093347132205963,
                    0.0024646157398819923 ,    0.19898845255374908 , -0.0017722384072840214),
                    jva: Matrix3::new(  -0.24996465444564819 , 0.0025190766900777817 ,-0.0028635300695896149,
                    -0.0025613077450543642,   -0.24996039271354675 , 0.0030392438638955355,
                    0.0028246273286640644, -0.0030743284150958061 ,  -0.24995741248130798),
                    jpg: Matrix3::new( 0.00010474638838786632,    0.017819192260503769 ,-0.00037856897688470781,
                    -0.017702225595712662  , -1.20296699606115e-05 ,  -0.016464702785015106,
                    0.00035101332468912005 ,   0.016334854066371918 , -0.0001122136673075147),
                    jpa: Matrix3::new(  -0.031247230246663094,  0.00022577264462597668 ,-0.00027414833311922848,
                    -0.00022906315280124545   , -0.03124709241092205 , 0.00027224412770010531,
                    0.00027129234513267875, -0.00027497674454934895  , -0.031246695667505264),
                }),
            },
            KeyFrameDummy {
                id: 63,
                prev_kf_id: 62,
                imu_position: Vector3::new(0.44713091850280762, -0.07178005576133728,-0.13675269484519958),
                velocity: Vector3::new(2.821101188659668, -0.51799303293228149,0.36035484075546265),
                imu_rotation: Matrix3::new(
                0.053350389003753662 ,  0.99845963716506958, -0.015234092250466347,
                -0.99755138158798218,   0.05259859561920166, -0.046094164252281189,
                -0.045221868902444839 , 0.017655933275818825 ,  0.99882090091705322
                ), 
                pose: Pose::new(
                    nalgebra::Vector3::new(-0.37995612621307373, 0.074861586093902588,0.1202501654624939),
                    nalgebra::Matrix3::new(
                        0.99920332431793213  , 0.038934390991926193, -0.0087681738659739494,
                        -0.038457300513982773 ,   0.99804669618606567 ,  0.049232501536607742,
                        0.010667884722352028 , -0.048856079578399658 ,   0.99874883890151978
                    ),
                ),
                imu_preintegrated: Some(ImuPreIntegrated {
                    b: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    bu: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    c: SMatrix::<f64, 15, 15>::from_row_slice(&[
                        7.2249992655315509e-09,-2.1032291301467307e-16,-3.1678100491068853e-16,-2.686850186783829e-10,6.0775575683180705e-09,2.1345326547961285e-11,-2.2097169580237441e-11,5.0195919643059028e-10,5.1819074205206039e-12,0.0,0.0,0.0,0.0,0.0,0.0,
-2.0988855716629903e-16,7.2249988214423411e-09,2.9249837025792065e-16,-6.2313443294215176e-09,-4.4203724014479917e-10,-5.8856817197749933e-09,-5.1475251838795089e-10,-3.6710440243226117e-11,-4.9332310458893858e-10,0.0,0.0,0.0,0.0,0.0,0.0,
-3.1355140063170589e-16,2.9423910237386705e-16,7.2249983773531312e-09,-4.6016268573367825e-10,6.0406981639005153e-09,-1.6056121709961957e-10,-4.1744576545488243e-11,5.0596760114984818e-10,-1.3364375578417409e-11,0.0,0.0,0.0,0.0,0.0,0.0,
-2.6868504643395852e-10,-6.2313429971538881e-09,-4.6016249144464894e-10,1.0072988061438082e-06,-3.2317565290540529e-10,6.8794965280005727e-09,1.2567863905132981e-07,-3.1131115046933999e-11,6.4847971437131946e-10,0.0,0.0,0.0,0.0,0.0,0.0
,6.0775540156043917e-09,-4.4203732341152602e-10,6.0406968316328857e-09,-3.231758471944346e-10,1.0137816843780456e-06,3.4180608343703511e-10,-3.439195803145445e-11,1.26290927937589e-07,3.629015837836036e-11,0.0,0.0,0.0,0.0,0.0,0.0
,2.1345321343790857e-11,-5.8856834961318327e-09,-1.6056125873298299e-10,6.8794960839113628e-09,3.4180597241473265e-10,1.0065158448924194e-06,6.4098554242164596e-10,3.2463597782195208e-11,1.256158128626339e-07,0.0,0.0,0.0,0.0,0.0,0.0,
-2.2097174784407869e-11,-5.1475262941025335e-10,-4.1744559198253484e-11,1.2567858220791095e-07,-3.4391926806431883e-11,6.4098576446625088e-10,2.0898539787594927e-08,-3.5193250223775063e-12,6.4442687297550094e-11,0.0,0.0,0.0,0.0,0.0,0.0
,5.0195902989713659e-10,-3.6710447182120021e-11,5.0596776768330187e-10,-3.1131142802509615e-11,1.2629095635929843e-07,3.246360125164216e-11,-3.5193274076222858e-12,2.096022733155678e-08,3.6605579678550271e-12,0.0,0.0,0.0,0.0,0.0,0.0
,5.1819069868397349e-12,-4.9332310458893858e-10,-1.3364375578417409e-11,6.4847971437131946e-10,3.6290154908913408e-11,1.2561582707348862e-07,6.444268035865619e-11,3.6605571004932891e-12,2.0893342167482842e-08,0.0,0.0,0.0,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,9.402204015351856e-11,0.0,0.0,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,9.402204015351856e-11,0.0,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,9.402204015351856e-11,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.2499993974633981e-06,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.2499993974633981e-06,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.2499993974633981e-06

]),
                    info: SMatrix::<f64, 15, 15>::zeros(),
                    nga_walk: calib.cov_walk,
                    nga: calib.cov,
                    d_b: SMatrix::<f64, 6, 1>::zeros(),
                    measurements: vec![],
                    d_t: 0.25,
                    d_v: Vector3::new(1.6868633031845093, 0.091458022594451904, -1.76534104347229),
                    d_p: Vector3::new(0.21399837732315063, 0.012879962101578712, -0.22073750197887421),
                    avg_a: Vector3::new(6.7474532127380371, 0.36583209037780762, -7.0613641738891602),
                    avg_w: Vector3::new(-0.11153353750705719, 0.10754718631505966, 0.17881946265697479),
                    d_r: Matrix3::new(  0.99864226579666138 ,-0.044997695833444595 , 0.026243748143315315,
                    0.044246040284633636 ,  0.99861234426498413 , 0.028559595346450806,
                    -0.027492452412843704, -0.027359642088413239 ,  0.99924767017364502),
                    jrg: Matrix3::new(  -0.24986426532268524 , -0.005861983634531498,  0.0041347569786012173,
                    0.0059417439624667168 ,  -0.24987208843231201 , 0.0036397078074514866,
                    -0.0040194503962993622, -0.0037665704730898142 ,  -0.24991966784000397),
                    jvg: Matrix3::new( 0.0028113482985645533 ,   0.21607036888599396   ,0.011531388387084007,
                    -0.21508744359016418,  0.0045052142813801765  , -0.20458203554153442,
                    -0.0070871356874704361 ,   0.20357908308506012 ,  0.001615918823517859),
                    jva: Matrix3::new(   -0.2499011754989624 , 0.0051783248782157898, -0.0025279149413108826,
                    -0.0051261419430375099 ,  -0.24989570677280426, -0.0032484435942023993,
                    0.0026217370759695768 , 0.0031652546022087336 ,  -0.24994672834873199),
                    jpg: Matrix3::new( 0.00016884699289221317   ,  0.01785493828356266  , 0.0010396598372608423,
                    -0.017811005935072899,   0.0002695916045922786   ,  -0.0171015914529562,
                    -0.00077334174420684576 ,   0.017058039084076881 , 9.6416042651981115e-05),
                    jpa: Matrix3::new(  -0.031244566664099693 , 0.00040747309685684741 ,-0.00015605064982082695,
                    -0.00040484842611476779  , -0.031243981793522835 ,-0.00025183605612255633,
                    0.00016145186964422464,  0.00024765270063653588 ,   -0.03124721348285675),
                }),
            },
            KeyFrameDummy {
                id: 64,
                prev_kf_id: 63,
                imu_position: Vector3::new(1.1524062156677246, -0.20127831399440765,-0.046663984656333923),
                velocity: Vector3::new(2.821101188659668, -0.51799303293228149,0.36035484075546265),
                imu_rotation: Matrix3::new(
                0.055149495601654053 ,   0.99553132057189941 , -0.076655119657516479,
                -0.99843829870223999 ,  0.054298460483551025 , -0.013143752701580524,
                -0.0089227557182312012 ,  0.077260278165340424  ,   0.9969710111618042
                ), 
                pose: Pose::new(
                    nalgebra::Vector3::new(-1.0743438005447388, 0.22774022817611694,0.093890011310577393),
                    nalgebra::Matrix3::new(
                        0.997886061668396 , 0.039771120995283127 , 0.051397062838077545,
                        -0.040530771017074585 ,  0.99908268451690674 , 0.013822863809764385,
                        -0.050800163298845291, -0.015876805409789085 ,  0.99858260154724121
                    ),
                ),
                imu_preintegrated: Some(ImuPreIntegrated {
                    b: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    bu: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    c: SMatrix::<f64, 15, 15>::from_row_slice(&[
                        7.2249988214423411e-09,1.3868707349922095e-16,-3.2477567244378904e-16,-2.439433655077039e-10,6.3688108120629749e-09,-4.2310760450803286e-10,-2.0223728941504149e-11,5.256706736567196e-10,-2.6570797645453226e-11,0.0,0.0,0.0,0.0,0.0,0.0
,1.3738813523971668e-16,7.2250001537099706e-09,-6.8731277512533423e-17,-6.3083818169218375e-09,-4.5664810821577362e-10,-5.9631299897944245e-09,-5.203686925803197e-10,-3.7738985547708381e-11,-4.9387033351777632e-10,0.0,0.0,0.0,0.0,0.0,0.0,
-3.2610861113519169e-16,-7.0032419381189535e-17,7.2249988214423411e-09,-3.2178659042925162e-11,5.8987170703517222e-09,-2.0829982183556695e-10,-1.1061374906307098e-11,4.8823034504152929e-10,-1.734176344192484e-11,0.0,0.0,0.0,0.0,0.0,0.0,
-2.439433655077039e-10,-6.3083822610110474e-09,-3.2178659042925162e-11,1.0074306828755653e-06,1.8367428411547593e-10,7.0399188700775994e-09,1.2568834506510029e-07,1.5457470373125837e-11,6.5474614618921123e-10,0.0,0.0,0.0,0.0,0.0,0.0
,6.3688143647766537e-09,-4.5664816372692485e-10,5.8987170703517222e-09,1.8367453391565647e-10,1.0141000075236661e-06,-1.9393628369890337e-10,6.8559819280111789e-12,1.2630933099444519e-07,-7.2437728558527592e-12,0.0,0.0,0.0,0.0,0.0,0.0,
-4.2310752124130602e-10,-5.9631308779728442e-09,-2.0829984959114256e-10,7.0399197582560191e-09,-1.9393602002093502e-10,1.0066802360597649e-06,6.5293787043785301e-10,-1.6270327099499049e-11,1.2562139772853698e-07,0.0,0.0,0.0,0.0,0.0,0.0,
-2.0223728941504149e-11,-5.2036863706916847e-10,-1.1061381845201002e-11,1.2568835927595501e-07,6.8559611113294672e-12,6.5293781492670178e-10,2.0899189934198148e-08,5.4489458735026974e-13,6.4691932366578442e-11,0.0,0.0,0.0,0.0,0.0,0.0
,5.2567095121247576e-10,-3.7738985547708381e-11,4.8823051157498298e-10,1.5457487720360596e-11,1.2630934520529991e-07,-1.6270351385627713e-11,5.4489697259504921e-13,2.0960772673106476e-08,-5.7406081841251955e-13,0.0,0.0,0.0,0.0,0.0,0.0,
-2.6570790706559322e-11,-4.9387038902892755e-10,-1.7341765176648316e-11,6.5474620170036246e-10,-7.2437520391710475e-12,1.2562139772853698e-07,6.4691932366578442e-11,-5.7405832474752283e-13,2.0892848340281489e-08,0.0,0.0,0.0,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,9.402204015351856e-11,0.0,0.0,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,9.402204015351856e-11,0.0,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,9.402204015351856e-11,0.0,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.2499993974633981e-06,0.0,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.2499993974633981e-06,0.0
,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.2499993974633981e-06

]),
                    info: SMatrix::<f64, 15, 15>::zeros(),
                    nga_walk: calib.cov_walk,
                    nga: calib.cov,
                    d_b: SMatrix::<f64, 6, 1>::zeros(),
                    measurements: vec![],
                    d_t: 0.25,
                    d_v: Vector3::new(1.6854925155639648, -0.028385663405060768, -1.7746956348419189),
                    d_p: Vector3::new(0.21028308570384979, -0.00044347302173264325, -0.22088718414306641),
                    avg_a: Vector3::new(6.7419700622558594, -0.11354264616966248, -7.0987825393676758),
                    avg_w: Vector3::new(-0.14225828647613525, -0.044931761920452118, 0.15497127175331116),
                    d_r: Matrix3::new(  0.99918335676193237 ,-0.038576405495405197 ,-0.012021909467875957,
                    0.038978468626737595  , 0.99861901998519897 , 0.035222798585891724,
                    0.010646537877619267,  -0.03566262498497963 ,  0.99930709600448608),
                    jrg: Matrix3::new(  -0.24994310736656189 ,-0.0040677343495190144 ,-0.0016440156614407897,
                    0.004024614579975605 ,  -0.24989940226078033 , 0.0043141790665686131,
                    0.0017439412185922265, -0.0042737764306366444 ,  -0.24993833899497986),
                    jvg: Matrix3::new(  0.003523651510477066  ,  0.21838642656803131, -0.0040277931839227676,
                    -0.21860677003860474 , 0.0059581650421023369 ,  -0.20647343993186951,
                    0.009931306354701519 ,   0.20668390393257141 , 0.0023938410449773073),
                    jva: Matrix3::new(  -0.24991720914840698 , 0.0055308579467236996 , 0.0011656370479613543,
                    -0.0055645778775215149  , -0.24986675381660461 ,-0.0044712903909385204,
                    -0.0010352382669225335,  0.0045087565667927265 ,  -0.24993821978569031),
                    jpg: Matrix3::new( 0.00022798196005169302 ,   0.018022384494543076 ,-9.8817698017228395e-05,
                    -0.018023336306214333 , 0.00037372743827290833 ,  -0.017113681882619858,
                    0.00046861678129062057 ,  0.017113840207457542, 0.00014418912178371102),
                    jpa: Matrix3::new(  -0.031244112178683281 , 0.00049509922973811626,  5.3212486818665639e-05,
                    -0.00049671047599986196 ,  -0.031240982934832573 ,-0.00035818811738863587,
                    -4.4575957872439176e-05,  0.00036003586137667298 ,  -0.031246326863765717),
                },
            )},

        ];

        // Set KeyFrame vertices
        let mut inc_kf = &keyframes[0];
        // let mut kf_vertex_fixed = HashMap::new();
    
        for kf in &keyframes {
            inc_kf = kf;

            let imu_calib = ImuCalib::new();

            let rot = kf.pose.get_quaternion();
            let imu_rot = nalgebra::geometry::UnitQuaternion::from_rotation_matrix(
                & nalgebra::Rotation3::from_matrix(& kf.imu_rotation)
            ); // lol whateverrr
            let tcb_rot = imu_calib.tcb.get_quaternion();

            optimizer.pin_mut().add_vertex_pose(
                kf.id,
                false,
                1, // TODO (Stereo... num cams shouldn't be 1)
                kf.imu_position.into(), // imu position
                [imu_rot.i, imu_rot.j, imu_rot.k, imu_rot.w], // imu rotation
                kf.pose.get_translation().into(), // translation
                [rot.i, rot.j, rot.k, rot.w], // rotation
                imu_calib.tcb.translation.into(), //tcb translation
                [tcb_rot.i, tcb_rot.j, tcb_rot.k, tcb_rot.w], // tcb rotation
                imu_calib.tbc.translation.into(), // tbc translation
                CAMERA_MODULE.stereo_baseline as f32
            );

            if kf.imu_preintegrated.is_some() {
                let imu_preintegrated = kf.imu_preintegrated.as_ref().unwrap();
                optimizer.pin_mut().add_vertex_velocity(
                    max_kf_id + 3 * kf.id + 1,
                    false,
                    kf.velocity.into()
                );

                println!("add vertex velocity {}", max_kf_id + 3 * kf.id + 1);
            }
        }

        // Biases
        optimizer.pin_mut().add_vertex_gyrobias(
            4 * max_kf_id + 2,
            false,
            inc_kf.imu_preintegrated.as_ref().unwrap().b.get_gyro_bias().into()
        );
        optimizer.pin_mut().add_vertex_accbias(
            4 * max_kf_id + 3,
            false,
            inc_kf.imu_preintegrated.as_ref().unwrap().b.get_acc_bias().into()
        );
        println!("add vertex gyro and acc {} {}", 4 * max_kf_id + 2, 4 * max_kf_id + 3);

        for kf in & keyframes {
            if kf.prev_kf_id == -1 ||
                kf.imu_preintegrated.is_none()
            {
                continue;
            }

            let mut imu_preintegrated = kf.imu_preintegrated.as_ref().unwrap().clone();
            let prev_kf_id = kf.prev_kf_id;

            for prev_kf in & keyframes {
                if prev_kf.id == prev_kf_id {
                    imu_preintegrated.set_new_bias(prev_kf.imu_preintegrated.as_ref().unwrap().b);
                }
            }

            let vp1_id = prev_kf_id;
            let vv1_id = max_kf_id + 3 * prev_kf_id + 1;

            let (vg1_id, va1_id, vg2_id, va2_id) = {
                let vg1_id = 4 * max_kf_id + 2;
                let va1_id = 4 * max_kf_id + 3;
                (vg1_id, va1_id, -1, -1)
            };

            let vp2_id = kf.id;
            let vv2_id = max_kf_id + 3 * kf.id + 1;

            println!("(all of them) {} {} {} {} {} {} ", vp1_id, vv1_id, vg1_id, va1_id, vp2_id, vv2_id);
            optimizer.pin_mut().add_edge_inertial(
                vp1_id,
                vv1_id,
                vg1_id,
                va1_id,
                vp2_id,
                vv2_id,
                (& imu_preintegrated).into(),
                true,
                16.92
            );

            // new_imu_preintegrated_for_kfs.insert(*kf_id, imu_preintegrated);

        }
        // for (id, preintegrated) in new_imu_preintegrated_for_kfs {
        //     debug!("SET KF {} IMU PREINTEGRATED", id);
        //     map.write().keyframes.get_mut(&id).unwrap().imu_data.imu_preintegrated = Some(preintegrated);
        // }

        let vertex_gyro_bias_id = 4 * max_kf_id + 2; // VG
        let vertex_acc_bias_id = 4 * max_kf_id + 3; // VA

        // Add prior to comon biases
        optimizer.pin_mut().add_edge_prior_for_imu(
            vertex_acc_bias_id,
            vertex_gyro_bias_id,
            [0.0, 0.0, 0.0],
            prior_a,
            prior_g
        );


        let ini_mp_id = max_kf_id * 5;
        let mut mps_not_included: HashSet<Id> = HashSet::new(); // vbNotIncludedMP

        // let mut _edges = Vec::new();
        // for (mp_id, mp) in & map.read().mappoints {
        //     let id = mp_id + ini_mp_id + 1;
        //     optimizer.pin_mut().add_vertex_sbapointxyz(
        //         id,
        //         Pose::new(* mp.position, Matrix3::identity()).into(),
        //         false, // todo should this be false? not specified 
        //         true
        //     );

        //     let mut all_fixed = true;

        //     //Set edges
        //     for (kf_id, (left_index, right_index)) in mp.get_observations() {
        //         if *kf_id > max_kf_id {
        //             continue;
        //         }

        //         if *left_index != -1 && *right_index == -1 {
        //             let (keypoint, _) = map.read().keyframes.get(kf_id).unwrap().features.get_keypoint(*left_index as usize);
        //             _edges.push(
        //                 optimizer.pin_mut().add_edge_mono_binary(
        //                     true, id, * kf_id,
        //                     *mp_id,
        //                     keypoint.pt().x, keypoint.pt().y,
        //                     INV_LEVEL_SIGMA2[keypoint.octave() as usize],
        //                     * TH_HUBER_MONO
        //                 )
        //             );

        //             if all_fixed && ! kf_vertex_fixed.get(kf_id).unwrap() {
        //                 all_fixed = false;
        //             }
        //         }

        //         if *right_index != -1 {
        //             todo!("Stereo");
        //             // kpUn = pKFi->mvKeysUn[leftIndex];
        //             // const float kp_ur = pKFi->mvuRight[leftIndex];
        //             // Eigen::Matrix<double,3,1> obs;
        //             // obs << kpUn.pt.x, kpUn.pt.y, kp_ur;

        //             // EdgeStereo* e = new EdgeStereo(0);

        //             // g2o::OptimizableGraph::Vertex* VP = dynamic_cast<g2o::OptimizableGraph::Vertex*>(optimizer.vertex(pKFi->mnId));
        //             // if(bAllFixed)
        //             //     if(!VP->fixed())
        //             //         bAllFixed=false;

        //             // e->setVertex(0, dynamic_cast<g2o::OptimizableGraph::Vertex*>(optimizer.vertex(id)));
        //             // e->setVertex(1, VP);
        //             // e->setMeasurement(obs);
        //             // const float invSigma2 = pKFi->mvInvLevelSigma2[kpUn.octave];

        //             // e->setInformation(Eigen::Matrix3d::Identity()*invSigma2);

        //             // g2o::RobustKernelHuber* rk = new g2o::RobustKernelHuber;
        //             // e->setRobustKernel(rk);
        //             // rk->setDelta(thHuberStereo);

        //             // optimizer.addEdge(e);
        //         }
        //         {
        //             // TODO multiple cameras
        //             // if(pKFi->mpCamera2){ // Monocular right observation
        //             //     int rightIndex = get<1>(mit->second);

        //             //     if(rightIndex != -1 && rightIndex < pKFi->mvKeysRight.size()){
        //             //         rightIndex -= pKFi->NLeft;

        //             //         Eigen::Matrix<double,2,1> obs;
        //             //         kpUn = pKFi->mvKeysRight[rightIndex];
        //             //         obs << kpUn.pt.x, kpUn.pt.y;

        //             //         EdgeMono *e = new EdgeMono(1);

        //             //         g2o::OptimizableGraph::Vertex* VP = dynamic_cast<g2o::OptimizableGraph::Vertex*>(optimizer.vertex(pKFi->mnId));
        //             //         if(bAllFixed)
        //             //             if(!VP->fixed())
        //             //                 bAllFixed=false;

        //             //         e->setVertex(0, dynamic_cast<g2o::OptimizableGraph::Vertex*>(optimizer.vertex(id)));
        //             //         e->setVertex(1, VP);
        //             //         e->setMeasurement(obs);
        //             //         const float invSigma2 = pKFi->mvInvLevelSigma2[kpUn.octave];
        //             //         e->setInformation(Eigen::Matrix2d::Identity()*invSigma2);

        //             //         g2o::RobustKernelHuber* rk = new g2o::RobustKernelHuber;
        //             //         e->setRobustKernel(rk);
        //             //         rk->setDelta(thHuberMono);

        //             //         optimizer.addEdge(e);
        //             //     }
        //         }
        //     }

        //     if all_fixed {
        //         optimizer.pin_mut().remove_vertex(id);
        //         mps_not_included.insert(* mp_id);
        //     }
        // }


        // println!("OPTIMIZE!");
        // // Compute error for different scales
        // optimizer.pin_mut().optimize(its, false, false);
        // println!("OPTIMIZATION DONE!");
    }

    #[test]
    fn test_inertial_optimization_initialization() {
        let mut system_config = env::current_dir().unwrap();
        system_config.push("orbslam_config.yaml");
        let mut dataset_config = env::current_dir().unwrap();
        dataset_config.push("config_datasets/EUROC.yaml");
        let _ = load_config(
            &system_config.into_os_string().into_string().unwrap(),
            &dataset_config.into_os_string().into_string().unwrap()
        ).expect("Could not load config");

        let camera_param = [458.654, 457.296, 367.215, 248.375];
        let fixed_velocity = false;
        let is_mono = true;
        let its = 200;

        let prior_g = 100;
        let mut rwg = DVMatrix3::new(nalgebra::Matrix3::new(
        1.0, -0.00016157647769432515 ,-9.8132491984870285e-05,
        -0.00016157647769432515 ,   -0.46106278896331787  ,   -0.8873676061630249,
        9.8132491984870285e-05  ,    0.8873676061630249  ,  -0.46106278896331787,
        ));

        let max_kf_id = 69;

        let mut optimizer = g2o::ffi::new_sparse_optimizer(5, camera_param, 1e3);

        struct KeyFrameDummy {
            id: Id,
            pose: Pose,
            imu_rotation: nalgebra::Matrix3<f64>,
            imu_position: nalgebra::Vector3<f64>,
            velocity: nalgebra::Vector3<f64>,
            prev_kf_id: Id,
            imu_preintegrated: Option<ImuPreIntegrated>,
        }
        let calib = ImuCalib::new();
        let mut keyframes = vec![
            KeyFrameDummy {
                id: 68,
                prev_kf_id: 67,
                imu_position: Vector3::new(0.052563358098268509, -0.013941730372607708,-0.033148720860481262),
                velocity: Vector3::new(-0.0056146830320358276, 0.0041640214622020721,0.0051008909940719604),
                imu_rotation: Matrix3::new(
                    0.021454691886901855,   0.99951684474945068, -0.022494221106171608,
                    -0.94412875175476074,  0.027656733989715576,   0.32841458916664124,
                    0.3288780152797699,  0.014191381633281708,   0.94426578283309937,
                ),
                pose: Pose::new(
                    nalgebra::Vector3::new(0.012558214366436005, -0.017952475696802139,0.027652006596326828),
                    nalgebra::Matrix3::new(
                        0.99997293949127197 , 0.0051449206657707691, -0.0052638892084360123,
                        -0.0065767262130975723 ,   0.94566380977630615,   -0.32507959008216858,
                        0.0033053609076887369 ,   0.32510539889335632,    0.94567203521728516),
                ),
                imu_preintegrated: Some(ImuPreIntegrated {
                    d_t: 0.25,
                    d_v: Vector3::new(1.6429973840713501, -0.067040152847766876, -1.7987534999847412),
                    d_p: Vector3::new(0.20898465812206268, -0.010243882425129414, -0.22423473000526428),
                    avg_a: Vector3::new(6.5719900131225586, -0.26816067099571228, -7.1950139999389648),
                    avg_w: Vector3::new(0.053421001881361008, 0.11258066445589066, 0.052722882479429245),
                    d_r: Matrix3::new(  0.99951821565628052, -0.012850119732320309 , 0.028258049860596657,
                    0.0132281593978405 ,   0.9998248815536499, -0.013237475417554379,
                    -0.028082994744181633 , 0.013604897074401379 ,  0.99951308965682983),
                    jrg: Matrix3::new(  -0.24994572997093201, -0.0023396611213684082,  0.0038452290464192629,
                    0.0022838604636490345,   -0.24996654689311981, -0.0029007107950747013,
                    -0.0038778628222644329 , 0.0028544871602207422 ,     -0.24993896484375),
                    jvg: Matrix3::new(0.00032438893686048687  ,  0.22095794975757599, -0.0061512556858360767,
                    -0.21954268217086792, 0.00045660970499739051 ,   -0.1992410272359848,
                    0.0065900329500436783 ,   0.19764706492424011, 0.00022740301210433245),
                    jva: Matrix3::new(    -0.2499653697013855,  0.00092204747488722205,  -0.0031115268357098103,
                    -0.000938445795327425  ,  -0.24999192357063293  ,0.00042617274448275566,
                    0.0031041447073221207, -0.00044800818432122469 ,   -0.24996590614318848),
                    jpg: Matrix3::new( 7.2877637649071403e-06  ,  0.018152430653572083, -0.00054425763664767146,
                    -0.018075786530971527,  3.3148731745313853e-05,   -0.016706325113773346,
                    0.0005788921844214201 ,   0.016622750088572502,  2.9583998184534721e-05),
                    jpa: Matrix3::new(  -0.031248195096850395 , 3.8365404179785401e-05, -0.00022042570344638079,
                    -3.8733913243049756e-05 ,  -0.031249659135937691, -2.7432235583546571e-05,
                    0.00022018638264853507,  2.6502557375351898e-05 ,  -0.031248185783624649),

                    b: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    bu: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },

                    c: SMatrix::<f64, 15, 15>::from_row_slice(&[
                        7.2250001537099706e-09, 1.0082096851802988e-16, 6.7021177549031095e-17, -8.9622871624062128e-11, 6.2221605645618183e-09, -2.5894800192993728e-10, -7.4053870674495315e-12, 5.1083975938226445e-10, -2.2945437216925768e-11, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        1.0059963483844539e-16, 7.2249983773531312e-09, 1.5142335206171222e-16, -6.3820384532675689e-09, -4.3388387500897796e-12, -5.7089368787899275e-09, -5.2426585295251016e-10, -2.0493014837169587e-13, -4.8010229125594606e-10, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        6.8425042014876492e-17, 1.5228463898528204e-16, 7.2250032623344396e-09, 2.6791507901080536e-10, 5.889965404293207e-09, 7.0432763787930952e-11, 2.3534858090146216e-11, 4.9498971588235463e-10, 5.8903407325339163e-12, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -8.962285774627432e-11, -6.3820380091783591e-09, 2.6791519003310782e-10, 1.0075930276798317e-06, 2.0130631883663597e-10, 6.825782605801578e-09, 1.2570120588861755e-07, 1.9661295161399472e-11, 6.439622168841197e-10, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        6.2221583441157691e-09, -4.3388378827280416e-12, 5.8899636279363676e-09, 2.0130623556990912e-10, 1.0137289336853428e-06, -2.2335473748302803e-10, 2.1568587194042976e-11, 1.262818614122807e-07, -2.3821965233761233e-11, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -2.5894789090763481e-10, -5.7089373228791374e-09, 7.0432763787930952e-11, 6.8257839380692076e-09, -2.2335475136081584e-10, 1.0061500006486312e-06, 6.3228455804420491e-10, -2.1346492282137142e-11, 1.2558227524550603e-07, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -7.4053888021730074e-12, -5.2426585295251016e-10, 2.3534866763763596e-11, 1.2570119167776284e-07, 2.1568592398213404e-11, 6.3228450253305368e-10, 2.0900333908002722e-08, 2.2948008510798035e-12, 6.3581181986016588e-11, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        5.1083981489341568e-10, -2.0492919969479495e-13, 4.9498988241580832e-10, 1.9661288222505569e-11, 1.2628184720142599e-07, -2.134649748630757e-11, 2.2948002005585e-12, 2.0958855984076763e-08, -2.4832714010103452e-12, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -2.2945437216925768e-11, -4.8010229125594606e-10, 5.8903411662147853e-12, 6.4396232790642216e-10, -2.3821961764314281e-11, 1.2558228945636074e-07, 6.3581181986016588e-11, -2.4832720515316486e-12, 2.0889984853056376e-08, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 9.402204015351856e-11, 0.0, 0.0, 0.0, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 9.402204015351856e-11, 0.0, 0.0, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 9.402204015351856e-11, 0.0, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.2499993974633981e-06, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.2499993974633981e-06, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.2499993974633981e-06
                    ]),
                    info: SMatrix::<f64, 15, 15>::zeros(),
                    nga_walk: calib.cov_walk,
                    nga: calib.cov,
                    d_b: SMatrix::<f64, 6, 1>::zeros(),
                    measurements: vec![],
                }),
            },
            KeyFrameDummy {
                id: 64,
                prev_kf_id: 63,
                imu_position: Vector3::new(0.065153799951076508, -0.016293080523610115,-0.017578557133674622),
                velocity: Vector3::new(-0.0066125094890594482, 0.0043714866042137146,-0.014322683215141296),
                imu_rotation: Matrix3::new(
                    0.017522633075714111  , 0.99956923723220825, -0.023545842617750168,
                    -0.92469871044158936,  0.025158286094665527 ,   0.3798677921295166,
                    0.3802964985370636,  0.015116488561034203 ,  0.92474108934402466,
                ), 
                pose: Pose::new(
                nalgebra::Vector3::new(4.174098648945801e-05, -0.012059287168085575,0.014219397678971291),
                nalgebra::Matrix3::new(
                    0.99999397993087769,  0.0016103017842397094 ,-0.0030716161709278822,
                    -0.0026484080590307713 ,   0.92639189958572388  , -0.37655144929885864,
                    0.0022391590755432844 ,   0.37655732035636902 ,   0.92639058828353882),
                ),
                imu_preintegrated: Some(ImuPreIntegrated {
                    b: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    bu: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    c: SMatrix::<f64, 15, 15>::from_row_slice(&[
                        7.2250014859776002e-09, 1.3596882565747369e-16, -3.4398113867115544e-17, -2.3145352301412458e-10, 6.6276690802169469e-09, -4.1616543544620299e-10, -1.9244784585370489e-11, 5.4923071646229005e-10, -4.2104320030489362e-11,0.0, 0.0,0.0, 0.0,0.0, 0.0, 
                        1.3705271019260397e-16, 7.2249992655315509e-09, -1.1881407913496916e-16, -6.6764913597694431e-09, -2.696910750277226e-10, -5.5709707957873889e-09, -5.5344390181844005e-10, -2.2450985515121147e-11, -4.7516279799708627e-10,0.0, 0.0,0.0, 0.0,0.0, 0.0, 
                        -4.0391437760478705e-17, -1.1870564568283081e-16, 7.2249992655315509e-09, 1.7498444360164456e-10, 5.6365796474722174e-09, -4.3169884333948971e-11, 2.1648304676658015e-11, 4.8085441184397837e-10, -3.7378789299880033e-12,0.0, 0.0,0.0, 0.0,0.0, 0.0, 
                        -2.3145349525854897e-10, -6.6764904715910234e-09, 1.7498440196828113e-10, 1.0083475672217901e-06, 2.5972224371173525e-10, 7.0187820000455758e-09, 1.2577845609484939e-07, 2.6254621740551265e-11, 6.7393107761049009e-10,0.0, 0.0,0.0, 0.0,0.0, 0.0, 
                        6.6276708565737863e-09, -2.6969115829444945e-10, 5.6365783152045879e-09, 2.5972218820058401e-10, 1.0142481414732174e-06, -3.0723820709788185e-10, 3.2387585668924856e-11, 1.2634765766961209e-07, -3.8146940467553847e-11,0.0, 0.0,0.0, 0.0,0.0, 0.0, 
                        -4.1616532442390053e-10, -5.5709712398765987e-09, -4.3169891272842875e-11, 7.0187828882239955e-09, -3.0723801280885255e-10, 1.0059244459625916e-06, 6.5754540701234987e-10, -3.0132184941633611e-11, 1.2557227080378652e-07,0.0, 0.0,0.0, 0.0,0.0, 0.0, 
                        -1.9244777646476585e-11, -5.5344373528498636e-10, 2.1648296003040635e-11, 1.2577848451655882e-07, 3.2387582199477905e-11, 6.5754524047889618e-10, 2.0908622389015363e-08, 3.4356070505864311e-12, 6.7306514528464589e-11,0.0, 0.0,0.0, 0.0,0.0, 0.0, 
                        5.4923060543998758e-10, -2.2450990719291575e-11, 4.8085430082167591e-10, 2.6254606128039981e-11, 1.2634765766961209e-07, -3.0132191880527515e-11, 3.4356077011077346e-12, 2.0967176439512514e-08, -3.9244913742353393e-12,0.0, 0.0,0.0, 0.0,0.0, 0.0, 
                        -4.210429921380765e-11, -4.7516274248593504e-10, -3.7378784963071343e-12, 6.7393118863279255e-10, -3.8146933528659943e-11, 1.2557228501464124e-07, 6.7306528406252397e-11, -3.9244918079162083e-12, 2.0890219332159177e-08,0.0, 0.0,0.0, 0.0,0.0, 0.0, 
                        0.0,0.0, 0.0,0.0, 0.0,0.0, 0.0,0.0, 0.0, 9.402204015351856e-11,0.0, 0.0,0.0, 0.0,0.0, 
                        0.0,0.0, 0.0,0.0, 0.0,0.0, 0.0,0.0, 0.0,0.0, 9.402204015351856e-11,0.0, 0.0,0.0, 0.0, 
                        0.0,0.0, 0.0,0.0, 0.0,0.0, 0.0,0.0, 0.0,0.0, 0.0, 9.402204015351856e-11,0.0, 0.0,0.0, 
                        0.0,0.0, 0.0,0.0, 0.0,0.0, 0.0,0.0, 0.0,0.0, 0.0,0.0, 2.2499993974633981e-06,0.0, 0.0, 
                        0.0,0.0, 0.0,0.0, 0.0,0.0, 0.0,0.0, 0.0,0.0, 0.0,0.0, 0.0, 2.2499993974633981e-06,0.0, 
                        0.0,0.0, 0.0,0.0, 0.0,0.0, 0.0,0.0, 0.0,0.0, 0.0,0.0, 0.0,0.0, 2.2499993974633981e-06, 
                    ]),
                    info: SMatrix::<f64, 15, 15>::zeros(),
                    nga_walk: calib.cov_walk,
                    nga: calib.cov,
                    d_b: SMatrix::<f64, 6, 1>::zeros(),
                    measurements: vec![],

                    d_t: 0.25,
                    d_v: Vector3::new(1.6419531106948853, -0.087301231920719147, -1.8895825147628784),
                    d_p: Vector3::new(0.21322952210903168, -0.013840669766068459, -0.23656366765499115),
                    avg_a: Vector3::new(6.567812442779541, -0.3492048978805542, -7.5583300590515137),
                    avg_w: Vector3::new(-0.025488810613751411, 0.033105131238698959, 0.1383558064699173),
                    d_r: Matrix3::new(   0.99937331676483154 , -0.034430492669343948 , 0.0082003436982631683,
                    0.034369952976703644  ,   0.9993816614151001 , 0.0074039222672581673,
                    -0.0084500368684530258 , -0.007117297500371933 ,   0.99993878602981567),
                    jrg: Matrix3::new(   -0.24985414743423462  ,-0.0034763282164931297 ,  0.0067102992907166481,
                    0.0034860249143093824  ,  -0.24996092915534973 , 0.00030672946013510227,
                    -0.006699955090880394, -0.00041044500540010631,    -0.24989157915115356),
                    jvg: Matrix3::new( 0.0031738136895000935 ,   0.23110058903694153 ,-0.0068172644823789597,
                    -0.23519101738929749 ,  0.004162592813372612  , -0.18804806470870972,
                    0.010513150133192539,    0.19303227961063385, 0.00061804498545825481),
                    jva: Matrix3::new(  -0.24987401068210602 , 0.0050426111556589603 , 0.0046668448485434055,
                    -0.005067234393209219  , -0.24993045628070831, -0.0012944695772603154,
                    -0.0046341712586581707 , 0.0013802256435155869 ,  -0.24993523955345154),
                    jpg: Matrix3::new( 0.00019500848429743201  ,  0.019156645983457565, -0.00082564353942871094,
                    -0.019491299986839294  ,0.00027035709354095161 ,  -0.016074687242507935,
                    0.0010691339848563075 ,   0.016472630202770233,  3.7503567000385374e-05),
                    jpa: Matrix3::new(  -0.031236687675118446 , 0.00044004622031934559 , 0.00066876161145046353,
                    -0.00044324048212729394 ,  -0.031245039775967598, -0.00012564445205498487,
                    -0.0006662395317107439 , 0.00013625934661831707 ,  -0.031240936368703842),
                }),

            },

            KeyFrameDummy {
                id: 65,
                prev_kf_id: 64,
                imu_position: Vector3::new(0.063500672578811646, -0.015200208872556686,-0.021159227937459946),
                velocity: Vector3::new(-0.018723160028457642, 0.0044164732098579407,-0.026826575398445129),
                imu_rotation: Matrix3::new(
                    0.026538729667663574   , 0.9991946816444397 ,-0.030099082738161087,
                    -0.93110984563827515,  0.035664916038513184 ,  0.36299145221710205,
                    0.36377257108688354 , 0.018392154946923256  , 0.93130624294281006,
                ), 
                pose: Pose::new(
                    Vector3::new(0.0019119349308311939, -0.01340000331401825,0.017429372295737267),
                    Matrix3::new(
                    0.99992245435714722  , 0.012451961636543274 ,-0.0002122418227372691,
                    -0.011693690903484821 ,   0.93289607763290405 ,  -0.35995578765869141,
                    -0.0042841555550694466 ,    0.3599303662776947 ,   0.93296933174133301),
                ),
                imu_preintegrated: Some(ImuPreIntegrated {
                    b: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    bu: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    c: SMatrix::<f64, 15, 15>::from_row_slice(&[
                        7.2249974891747115e-09, 8.5059644133317878e-17, 4.9567980952794981e-17, -1.9323265210147156e-10, 6.5186678277484589e-09, -5.6113363955390128e-10, -1.5854699497719338e-11, 5.3541576727766937e-10, -4.5362172351737229e-11, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        8.5054092097046422e-17, 7.2250010418883903e-09, 8.5329159429222356e-17, -6.6390675179661685e-09, -1.4317082241976919e-10, -5.3189088689009623e-09, -5.4513521474675031e-10, -1.1810889072316755e-11, -4.2930015098363583e-10, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        4.9926391694769307e-17, 8.4678849883967867e-17, 7.2249988214423411e-09, 4.5884124277861815e-10, 5.4840878505046931e-09, 2.6600017327682579e-11, 3.7168882555116411e-11, 4.4284820255313662e-10, 2.1453336069426898e-12, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -1.9323265210147156e-10, -6.6390666297877488e-09, 4.5884129828976938e-10, 1.0082437711389503e-06, 4.0729325467836475e-10, 6.5623488865185209e-09, 1.2576076358072896e-07, 3.6731593461292178e-11, 5.972326522218907e-10, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        6.5186656073024096e-09, -1.43170836297557e-10, 5.4840887386831128e-09, 4.0729325467836475e-10, 1.0134561989616486e-06, -5.09714104257597e-10, 3.6230653893687403e-11, 1.2623439715753193e-07, -4.5412142796186217e-11, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -5.6113358404275004e-10, -5.318909757079382e-09, 2.6600024266576483e-11, 6.5623502187861504e-09, -5.0971393772414331e-10, 1.0052762036139029e-06, 6.0459559581005351e-10, -4.6621442817418313e-11, 1.2547928918138496e-07, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -1.5854699497719338e-11, -5.4513499270214538e-10, 3.7168889494010315e-11, 1.2576076358072896e-07, 3.6230657363134355e-11, 6.0459554029890228e-10, 2.0906128384012845e-08, 3.4590180112564761e-12, 5.8754383303050162e-11, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        5.3541543421076199e-10, -1.1810887337593279e-11, 4.4284831357543908e-10, 3.673159693073913e-11, 1.262343687358225e-07, -4.6621435878524409e-11, 3.4590184449373451e-12, 2.0952144907937509e-08, -4.3930987320139891e-12, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -4.5362161943396373e-11, -4.2930026200593829e-10, 2.1453344743044278e-12, 5.9723276324419317e-10, -4.5412149735080121e-11, 1.2547931760309439e-07, 5.8754376364156258e-11, -4.3930995993757271e-12, 2.0877806150565448e-08, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 9.402204015351856e-11, 0.0, 0.0, 0.0, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 9.402204015351856e-11, 0.0, 0.0, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 9.402204015351856e-11, 0.0, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.2499993974633981e-06, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.2499993974633981e-06, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.2499993974633981e-06
                    ]),
                    info: SMatrix::<f64, 15, 15>::zeros(),
                    nga_walk: calib.cov_walk,
                    nga: calib.cov,
                    d_b: SMatrix::<f64, 6, 1>::zeros(),
                    measurements: vec![],

                    d_t: 0.25,
                    d_v: Vector3::new(1.4808341264724731, -0.11205725371837616, -1.8657259941101074),
                    d_p: Vector3::new(0.18199270963668823, -0.013411546126008034, -0.23184247314929962),
                    avg_a: Vector3::new(5.9233365058898926, -0.44822901487350464, -7.4629039764404297),
                    avg_w: Vector3::new(0.02710844948887825, 0.09195806086063385, 0.11060495674610138),
                    d_r: Matrix3::new(   0.99935609102249146,  -0.027493512257933617 ,   0.02305203303694725,
                    0.027656316757202148   , 0.99959439039230347 ,-0.0067775910720229149,
                    -0.022856350988149643 ,  0.007410719059407711  ,  0.99971127510070801),
                    jrg: Matrix3::new(   -0.24995166063308716,  -0.0040483647026121616 , 0.00040941667975857854,
                    0.0040432210080325603   , -0.24995721876621246, -0.00076707237167283893,
                    -0.00042611887329258025 , 0.00074987602420151234  ,  -0.24999085068702698),
                    jvg: Matrix3::new(  0.0018189355032518506  ,   0.22987619042396545  , -0.014887768775224686,
                    -0.22657132148742676 ,   0.001055364846251905 ,   -0.18857833743095398,
                    0.015584514476358891 ,    0.18440923094749451, -0.00020024206605739892),
                    jva: Matrix3::new(  -0.24991331994533539,  0.0027749941218644381, -0.0052749426104128361,
                    -0.002799157053232193  ,  -0.2499738484621048 ,0.00092200521612539887,
                    0.0052598277106881142, -0.0009917145362123847 ,  -0.24993434548377991),
                    jpg: Matrix3::new( 0.00010889454279094934 ,    0.01887618750333786 ,  -0.001191579969599843,
                    -0.018650669604539871 , 6.1827282479498535e-05 ,  -0.015175336040556431,
                    0.001230010180734098 ,   0.014886263757944107, -7.9605088103562593e-06),
                    jpa: Matrix3::new(   -0.03124280646443367 , 0.00020525595755316317 , -0.0005455060163512826,
                    -0.00020715997379738837 ,  -0.031248642131686211 , 7.5453943281900138e-05,
                    0.00054462754633277655, -8.0382160376757383e-05,   -0.031243832781910896),
                }),

            },

            KeyFrameDummy {
                id: 61,
                prev_kf_id: 60,
                imu_position: Vector3::new(0.064934507012367249, -0.019465934485197067,-0.010194282978773117),
                velocity: Vector3::new(-0.0010384023189544678, -0.0044052079319953918,-0.020647265017032623),
                imu_rotation: Matrix3::new(
                    0.012374401092529297 ,  0.99853307008743286 ,-0.052712421864271164,
                    -0.99968439340591431,  0.013506889343261719,  0.021181788295507431,
                    0.0218626968562603,  0.052433673292398453  , 0.99838507175445557,
                ), 
                pose: Pose::new(
                nalgebra::Vector3::new(0.0005503623397089541, -0.0015742180403321981,0.0042237979359924793),
                nalgebra::Matrix3::new(
                    0.9996335506439209, -0.0019058283651247621 ,  0.027002641931176186,
                    0.002374232979491353 ,   0.99984711408615112,  -0.017325188964605331,
                    -0.026965493336319923 ,  0.017382951453328133 ,   0.99948519468307495),
                ),
                imu_preintegrated: Some(ImuPreIntegrated {
                    b: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    bu: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    c: SMatrix::<f64, 15, 15>::from_row_slice(&[
                        4.3349932532521507e-09, -1.3794795784340276e-16, 9.6516062529952809e-17, -1.4090595010229912e-11, 1.4528869218821683e-09, -5.1405862205866626e-11, -6.953002084676696e-13, 7.2168097886571303e-11, -2.883886272148084e-12, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -1.3843639145150308e-16, 4.3349914768953113e-09, -6.0446137235528792e-17, -1.4117093050103335e-09, 5.7898293798208655e-11, -2.8886346647993832e-09, -7.0115371841872332e-11, 2.8741405956600463e-12, -1.4341038079290769e-10, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        9.6296892754850759e-17, -6.0717439241556384e-17, 4.3349919209845211e-09, 5.7736405933983548e-11, 2.869410264949579e-09, 7.3503057806956207e-11, 3.1990033452083955e-12, 1.4245890578301612e-10, 3.6537964494265385e-12, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -1.4090596744953388e-11, -1.4117091939880311e-09, 5.77364094034305e-11, 6.0062671991545358e-07, 2.1459750643160191e-11, 1.2838807794679497e-09, 4.5034916240638267e-08, 1.1863321739899457e-12, 7.1788873456934965e-11, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        1.4528865888152609e-09, 5.7898293798208655e-11, 2.8694093767711593e-09, 2.1459698601455912e-11, 6.0325271533656633e-07, -1.0521290436105168e-11, 1.325322338853463e-12, 4.5181849372966099e-08, -6.5002793729271313e-13, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -5.140585179752577e-11, -2.8886339986655685e-09, 7.3503050868062303e-11, 1.2838802243564373e-09, -1.0521280895126051e-11, 6.02625163992343e-07, 7.1696759640360597e-11, -5.8079295496213379e-13, 4.5146844485088877e-08, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -6.9530026267777822e-13, -7.0115364902978428e-11, 3.199003128367961e-12, 4.5034916240638267e-08, 1.3253252661993287e-12, 7.1696780457042308e-11, 4.5008130555856951e-09, 7.2685333771770055e-14, 4.2719001079605246e-12, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        7.2168111764359111e-11, 2.8741405956600463e-12, 1.4245889190522831e-10, 1.18632924664408e-12, 4.5181856478393456e-08, -5.8079197918017855e-13, 7.2685123707599136e-14, 4.5095815970341846e-09, -3.5632409430821563e-14, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -2.8838851879459115e-12, -1.4341035303733207e-10, 3.6537955820648005e-12, 7.1788852640253253e-11, -6.5002902149488562e-13, 4.5146844485088877e-08, 4.2719001079605246e-12, -3.5632612718728904e-14, 4.5075023713536666e-09, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 5.6413235194341382e-11, 0.0, 0.0, 0.0, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 5.6413235194341382e-11, 0.0, 0.0, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 5.6413235194341382e-11, 0.0, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.3499997066901415e-06, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.3499997066901415e-06, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.3499997066901415e-06,
                    ]),
                    info: SMatrix::<f64, 15, 15>::zeros(),
                    nga_walk: calib.cov_walk,
                    nga: calib.cov,
                    d_b: SMatrix::<f64, 6, 1>::zeros(),
                    measurements: vec![],
                    d_t: 0.14999985694885254,
                    d_v: Vector3::new(1.3873128890991211, -0.013748855330049992, -0.68327921628952026),
                    d_p: Vector3::new(0.10463036596775055, -0.0012681121006608009, -0.051898114383220673),
                    avg_a: Vector3::new(9.2487621307373047, -0.091659113764762878, -4.5551986694335938),
                    avg_w: Vector3::new(0.16837774217128754, -0.091909013688564301, 0.069475725293159485),
                    d_r: Matrix3::new(   0.9998508095741272 , -0.01053972914814949 ,-0.013685550540685654,
                    0.010190709494054317 ,  0.99962717294692993 ,-0.025329751893877983,
                    0.013947419822216034 , 0.025186512619256973 ,  0.99958544969558716),
                    jrg: Matrix3::new(  -0.14999215304851532 ,-0.0007614466012455523 ,-0.0011042744154110551,
                    0.00077580829383805394 ,  -0.14998647570610046, -0.0013885356020182371,
                    0.0010938690975308418 , 0.0013958389172330499 ,  -0.14998398721218109),
                    jvg: Matrix3::new(0.00016614087508060038 ,  0.048872664570808411 , -0.001321782823652029,
                    -0.04930848628282547 ,-0.0009747506701387465,  -0.099783279001712799,
                    0.0011054986389353871 ,  0.099985994398593903 ,-0.0011517694219946861),
                    jva: Matrix3::new(   -0.14999328553676605 , 0.00077400804730132222 , 0.00092895393026992679,
                    -0.00075520062819123268  ,  -0.14997455477714539 ,  0.0023365109227597713,
                    -0.00094421522226184607 , -0.0023300747852772474  ,  -0.14997319877147675),
                    jpg: Matrix3::new( 6.2933777371654287e-06  , 0.0024275716859847307, -7.1240865509025753e-05,
                    -0.0024441683199256659 ,-3.8114569179015234e-05  ,-0.0049565881490707397,
                    6.2396778957918286e-05,   0.0049641914665699005 ,-4.4967961002839729e-05),
                    jpa: Matrix3::new(  -0.011249741539359093 , 3.8502697861986235e-05 , 4.5719956688117236e-05,
                    -3.7752968637505546e-05 ,  -0.011248891241848469 , 0.00012551977124530822,
                    -4.6332588681252673e-05, -0.00012528603838291019 ,  -0.011248843744397163),
                }),
            },
            KeyFrameDummy {
                id: 63,
                prev_kf_id: 62,
                imu_position: Vector3::new(0.065321557223796844, -0.014800267294049263,-0.015544840134680271),
                velocity: Vector3::new(-0.00067102909088134766, -0.0059712529182434082,-0.0081348679959774017),
                imu_rotation: Matrix3::new(
                    0.0027487277984619141  , 0.99959427118301392 , -0.02835303358733654,
                    -0.92415308952331543 , 0.013370513916015625 ,  0.38178843259811401,
                    0.38201260566711426 , 0.025153091177344322  , 0.92381477355957031,
                ), 
                pose: Pose::new(
                    nalgebra::Vector3::new(-0.00013583186955656856, -0.013674730435013771,0.012104427441954613),
                    nalgebra::Matrix3::new(
                    0.99992328882217407  ,-0.010213621892035007 , 0.0070099327713251114,
                    0.012106046080589294 ,  0.92567718029022217  , -0.37812060117721558,
                    -0.0026269541122019291 ,   0.37817645072937012 ,   0.92572981119155884),
                ),
                imu_preintegrated: Some(ImuPreIntegrated {
                    b: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    bu: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    c: SMatrix::<f64, 15, 15>::from_row_slice(&[
                        7.2249819460523668e-09, 8.3139354267443375e-16, -1.25338244532077e-16, -1.5811764397799521e-10, 6.5315943764687745e-09, -3.7774589012329329e-10, -1.3611185095685485e-11, 5.3451687520578162e-10, -2.8468364818290404e-11, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        8.3269453234185715e-16, 7.2249983773531312e-09, -2.3456934230290175e-15, -4.7470338770949638e-09, -2.9523283817667334e-10, -7.3793144927947196e-09, -3.9259973050320696e-10, -2.4046212937500755e-11, -5.888265430797901e-10, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -1.2092567933291493e-16, -2.3448264848075027e-15, 7.2249815019631569e-09, 5.7817153842343316e-11, 5.8645377443156121e-09, -2.8346497024656081e-11, 2.8404075966270703e-12, 4.6422385380218145e-10, -2.7213374782786293e-12, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -1.581176162224196e-10, -4.7470316566489146e-09, 5.7817167720131124e-11, 1.0042114126918023e-06, 1.2261591741946631e-10, 6.4914504882551682e-09, 1.2539211979856191e-07, 1.0985435651422737e-11, 5.8364513222386449e-10, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        6.5315939323795646e-09, -2.9523281042109772e-10, 5.8645377443156121e-09, 1.2261541781910523e-10, 1.014223812489945e-06, -7.9501599747899832e-11, 9.6837962995643956e-12, 1.2628736101305549e-07, -6.3572771179243315e-12, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -3.7774583461214206e-10, -7.3793144927947196e-09, -2.8346502228826509e-11, 6.4914478237199091e-09, -7.950157893121812e-11, 1.0100156941916794e-06, 6.0104737853450274e-10, -7.3854923912652914e-12, 1.258955961702668e-07, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -1.3611183360962009e-11, -3.9259953621417765e-10, 2.8404101987122843e-12, 1.2539210558770719e-07, 9.6838283919487012e-12, 6.0104771160141013e-10, 2.087018735608126e-08, 1.0053199592241491e-12, 5.7659873403670403e-11, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        5.3451654213887423e-10, -2.4046212937500755e-11, 4.6422379829103022e-10, 1.0985395752782789e-11, 1.262873752239102e-07, -7.3854889218183395e-12, 1.0053171402985006e-12, 2.0955647883624806e-08, -6.8302920827947866e-13, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -2.8468359614119976e-11, -5.8882665410209256e-10, -2.7213374782786293e-12, 5.8364479915695711e-10, -6.3572736484773795e-12, 1.258955961702668e-07, 5.7659838709200883e-11, -6.8302909985926141e-13, 2.0916758103339816e-08, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 9.402204015351856e-11, 0.0, 0.0, 0.0, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 9.402204015351856e-11, 0.0, 0.0, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 9.402204015351856e-11, 0.0, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.2499993974633981e-06, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.2499993974633981e-06, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.2499993974633981e-06,
                    ]),
                    info: SMatrix::<f64, 15, 15>::zeros(),
                    nga_walk: calib.cov_walk,
                    nga: calib.cov,
                    d_b: SMatrix::<f64, 6, 1>::zeros(),
                    measurements: vec![],
                    d_t: 0.25,
                    d_v: Vector3::new(2.0204722881317139, -0.031902521848678589, -1.3421415090560913),
                    d_p: Vector3::new(0.24441269040107727, -0.0045811561867594719, -0.16785305738449097),
                    avg_a: Vector3::new(8.0818881988525391, -0.12761008739471436, -5.3685660362243652),
                    avg_w: Vector3::new(-0.046348940581083298, -1.0723792314529419, 0.15366570651531219),
                    d_r: Matrix3::new(  0.96356040239334106, -0.035324349999427795  ,-0.26514852046966553,
                    0.038633696734905243   ,0.99922704696655273 ,  0.00727464584633708,
                    0.26468658447265625, -0.017253227531909943 ,  0.96418017148971558),
                    jrg: Matrix3::new(  -0.24691601097583771  , -0.00555811682716012 ,  -0.03277004137635231,
                    0.0051838443614542484 ,  -0.24991427361965179  ,0.0027889225166290998,
                    0.032829716801643372, -0.0018560719909146428  , -0.24697643518447876),
                    jvg: Matrix3::new(  0.0012895995751023293    , 0.16432088613510132  ,-0.0032768240198493004,
                    -0.18606241047382355  , 0.0019865033682435751   , -0.23971183598041534,
                    0.0058625494129955769   ,  0.25559434294700623, -0.00031180353835225105),
                    jva: Matrix3::new(   -0.24689684808254242 ,  0.0038762595504522324   , 0.033148035407066345,
                    -0.0040240464732050896   , -0.24995122849941254 ,-0.00025768263731151819,
                    -0.033129226416349411  , 0.0010080542415380478   ,-0.24694061279296875),
                    jpg: Matrix3::new( 8.3343424194026738e-05 ,   0.013591304421424866 ,-0.00020501766994129866,
                    -0.014879333786666393 , 0.00010784313781186938  , -0.019455114379525185,
                    0.00034802916343323886  ,  0.020395580679178238 , -1.173567034129519e-05),
                    jpa: Matrix3::new(  -0.031061571091413498 , 0.00029760182951577008 ,  0.0026778646279126406,
                    -0.00030240518390201032  , -0.031247382983565331, -2.0014349502162077e-06,
                    -0.0026772797573357821 , 4.5487053284887224e-05  , -0.031064065173268318),
                }),
            },
            KeyFrameDummy {
                id: 67,
                prev_kf_id: 66,
                imu_position: Vector3::new(0.055349759757518768, -0.013602577149868011,-0.032469864934682846),
                velocity: Vector3::new(-0.011145606637001038, -0.001356612890958786,-0.0027154237031936646),
                imu_rotation: Matrix3::new(
                    0.027684986591339111   , 0.99958515167236328 ,-0.0079379212111234665,
                    -0.93630492687225342 ,  0.028711855411529541 ,   0.35001230239868164,
                    0.35009503364562988, -0.0022577759809792042  ,  0.93671143054962158,
                ), 
                pose: Pose::new(
                nalgebra::Vector3::new(0.0092766145244240761, -0.018495311960577965,0.02612202987074852),
                nalgebra::Matrix3::new(
                    0.99975878000259399 ,0.0057592187076807022  , -0.0211956687271595,
                    -0.012750620953738689  , 0.93793791532516479 , -0.34656870365142822,
                    0.017884258180856705 ,  0.34675535559654236  , 0.93778508901596069),
                ),
                imu_preintegrated: Some(ImuPreIntegrated {
                    b: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    bu: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    c: SMatrix::<f64, 15, 15>::from_row_slice(&[
                        7.2249988214423411e-09, -1.9760962676448832e-17, -2.5496826604154863e-17, -4.5963368527912607e-11, 6.2078422402578326e-09, -2.8427230014393956e-10, -3.7553588710936836e-12, 5.1404464018744989e-10, -2.6602744312986815e-11, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -1.9868875004801275e-17, 7.2249966009962918e-09, 4.6438240534804644e-17, -6.1122475969455081e-09, -7.3048428417266109e-11, -5.8848987904980277e-09, -5.0643911286840648e-10, -5.9791238800344093e-12, -4.6928322339212514e-10, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -2.6258823730077487e-17, 4.6220394248682679e-17, 7.2250010418883903e-09, 2.1258614313346413e-10, 5.7849658396946779e-09, -1.8871411378018621e-11, 2.0812532253167149e-11, 4.610308523833595e-10, -1.4397954399905655e-12, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -4.5963382405700415e-11, -6.1122453764994589e-09, 2.125862680335544e-10, 1.0069900326925563e-06, 2.6754537474360518e-10, 6.6584564528682222e-09, 1.2565193685531995e-07, 2.4592907571507894e-11, 5.9981070110737278e-10, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        6.207844016614672e-09, -7.3048421478372205e-11, 5.7849636192486287e-09, 2.6754520821015149e-10, 1.0133331898032338e-06, -2.8086089010059823e-10, 2.8248696784527461e-11, 1.2622020051367144e-07, -2.9765002962367504e-11, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -2.8427224463278833e-10, -5.8849005668548671e-09, -1.8871411378018621e-11, 6.6584564528682222e-09, -2.8086077907829576e-10, 1.0063677109428681e-06, 6.1771543435895637e-10, -2.6697439398093437e-11, 1.2557093498344329e-07, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -3.7553601721362906e-12, -5.0643905735725525e-10, 2.0812537457337577e-11, 1.2565190843361052e-07, 2.8248715866485696e-11, 6.1771543435895637e-10, 2.0896120389579664e-08, 2.7266817276272448e-12, 5.9466549739983776e-11, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        5.1404469569860112e-10, -5.9791238800344093e-12, 4.610308523833595e-10, 2.459289195899661e-11, 1.2622022893538087e-07, -2.6697435928646485e-11, 2.7266786918611619e-12, 2.09506296755535e-08, -2.9666555670382344e-12, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -2.6602746047710291e-11, -4.692833344144276e-10, -1.4397953315703482e-12, 5.9981064559622155e-10, -2.9764999492920552e-11, 1.2557092077258858e-07, 5.9466535862195968e-11, -2.9666551333573654e-12, 2.088606265715498e-08, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 9.402204015351856e-11, 0.0, 0.0, 0.0, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 9.402204015351856e-11, 0.0, 0.0, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 9.402204015351856e-11, 0.0, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.2499993974633981e-06, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.2499993974633981e-06, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.2499993974633981e-06,
                    ]),
                    info: SMatrix::<f64, 15, 15>::zeros(),
                    nga_walk: calib.cov_walk,
                    nga: calib.cov,
                    d_b: SMatrix::<f64, 6, 1>::zeros(),
                    measurements: vec![],
                    d_t: 0.25,
                    d_v: Vector3::new(1.6290926933288574, -0.06676047295331955, -1.7371900081634521),
                    d_p: Vector3::new(0.19949626922607422, -0.0083476314321160316, -0.21848225593566895),
                    avg_a: Vector3::new(6.5163712501525879, -0.26704195141792297, -6.9487600326538086),
                    avg_w: Vector3::new(-0.016315337270498276, -0.066210761666297913, 0.032358463853597641),
                    d_r: Matrix3::new(   0.99982988834381104 ,-0.0080947689712047577 , -0.016565036028623581,
                    0.0081600174307823181  ,  0.99995899200439453,  0.0038704476319253445,
                    0.016533054411411285, -0.0040048104710876942  ,  0.99985522031784058),
                    jrg: Matrix3::new(   -0.24997143447399139 , 0.00018198178440798074 , -0.0032505509443581104,
                    -0.00018394961080048233,    -0.24999840557575226 , 0.00017155359091702849,
                    0.0032512219622731209, -0.00017240735178347677  ,   -0.2499723881483078),
                    jvg: Matrix3::new( 0.0016400746535509825   , 0.21148858964443207 ,-0.0075124846771359444,
                    -0.2114170640707016 , 0.0022752117365598679,   -0.20376567542552948,
                    0.0097618270665407181  ,  0.20363414287567139, 0.00064915668917819858),
                    jva: Matrix3::new(   -0.24998173117637634  , 0.0021882457658648491 , 0.00084800273180007935,
                    -0.0021907049231231213  ,  -0.24998755753040314, -0.00081278209108859301,
                    -0.00083996192552149296 , 0.00082182057667523623  ,   -0.2499910295009613),
                    jpg: Matrix3::new(  0.0001179326354758814  ,  0.017523059621453285 ,-0.00073833123315125704,
                    -0.017494777217507362 , 0.00016268038598354906  , -0.016273627057671547,
                    0.00089691829634830356  ,  0.016239386051893234 , 4.8110778152476996e-05),
                    jpa: Matrix3::new(  -0.031248535960912704 , 0.00023674908152315766 ,-9.1095325842616148e-06,
                    -0.00023671332746744156  , -0.031248677521944046 , -9.611697169020772e-05,
                    1.0017049135058187e-05 , 9.6216564998030663e-05 ,  -0.031249487772583961),
                }),
            },
            KeyFrameDummy {
                id: 60,
                prev_kf_id: -1,
                imu_position: Vector3::new(0.065222904086112976, -0.020706389099359512,-0.0080546028912067413),
                velocity: Vector3::new(-0.0019226489821448922, 0.0082697048783302307,-0.014264547266066074),
                imu_rotation: Matrix3::new(
                    0.014865398406982422  ,  0.9995572566986084 ,-0.025774437934160233,
                    -0.99988096952438354 , 0.014967083930969238, 0.0037561894860118628,
                    0.0041402950882911682,  0.025715531781315804,   0.99966073036193848,
                ), 
                pose: Pose::new(
                    nalgebra::Vector3::new(0.0, 0.0,0.0),
                    nalgebra::Matrix3::new(
                    1.0, 0.0, 0.0,
                    0.0, 1.0, 0.0,
                    0.0, 0.0, 1.0),
                ),
                imu_preintegrated: None

            },
            KeyFrameDummy {
                id: 62,
                prev_kf_id: 61,
                imu_position: Vector3::new(0.064674906432628632, -0.020567236468195915,-0.015356099233031273),
                velocity: Vector3::new(0.0025866031646728516, 0.023067876696586609,-0.00075496360659599304),
                imu_rotation: Matrix3::new(
                    -0.0075674057006835938   , 0.99911296367645264 ,   -0.0414271280169487,
                    -0.99308192729949951 ,-0.0026541948318481445  ,  0.11739389598369598,
                    0.11717980355024338 ,  0.042028889060020447 ,   0.99222099781036377,
                ), 
                pose: Pose::new(
                nalgebra::Vector3::new(0.00043093276326544583, -0.0034543732181191444,0.01054733619093895),
                nalgebra::Matrix3::new(
                    0.9996258020401001 ,-0.020441252738237381 , 0.018178274855017662,
                    0.022364677861332893  , 0.99336487054824829,  -0.11280982196331024,
                    -0.015751684084534645 ,  0.11317415535449982 ,  0.99345028400421143),
                ),
                imu_preintegrated: Some(ImuPreIntegrated {
                    b: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    bu: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    c: SMatrix::<f64, 15, 15>::from_row_slice(&[
                        7.2249979332639214e-09, 3.3650048778814028e-16, -7.4452277004631877e-17, 1.3826282783610533e-13, 4.7203378983340372e-09, -2.8258564932492902e-10, 3.0848790861202902e-13, 3.957540128940451e-10, -2.6890170645721412e-11, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        3.3563471423692798e-16, 7.2249974891747115e-09, -7.1146525787180057e-17, -4.0836005688049681e-09, -1.22304930072481e-10, -7.1091426079306075e-09, -3.4195238307610509e-10, -1.0326399457749602e-11, -6.0102145482687774e-10, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -7.0895572424221269e-17, -7.1363485335685365e-17, 7.2249966009962918e-09, 1.8478195362714445e-10, 6.7022347671752414e-09, -7.9556423948634603e-11, 1.8668993434500791e-11, 5.6694099415111054e-10, -6.4473873288839467e-12, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        1.3826136416317247e-13, -4.0835996806265484e-09, 1.847818703604176e-10, 1.0031401416199515e-06, 3.4116240388293306e-10, 5.4639097690767358e-09, 1.252967649634229e-07, 3.3700649909595981e-11, 5.2072507417122438e-10, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        4.720338342423247e-09, -1.2230491619469319e-10, 6.7022352112644512e-09, 3.4116240388293306e-10, 1.0126738061444485e-06, -1.9507849502442554e-10, 3.8137153157702386e-11, 1.2620650124972599e-07, -2.1766139238210691e-11, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -2.8258562156935341e-10, -7.1091434961090272e-09, -7.9556444765316314e-11, 5.4639088808983161e-09, -1.9507828685760842e-10, 1.0095590141645516e-06, 5.1657639277280509e-10, -1.9079482785344659e-11, 1.2591284814789105e-07, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        3.0848766466654021e-13, -3.4195243858725632e-10, 1.8668991699777315e-11, 1.2529673654171347e-07, 3.8137146218808482e-11, 5.1657650379510756e-10, 2.0861165239693946e-08, 4.0555102678863086e-12, 5.2509541853540398e-11, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        3.9575412391634757e-10, -1.0326401192473078e-11, 5.6694082761765685e-10, 3.3700653379042933e-11, 1.2620648703887127e-07, -1.9079494928408991e-11, 4.0555107015671776e-12, 2.0953779156229757e-08, -2.2914664957185416e-12, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -2.6890163706827508e-11, -6.0102162136033144e-10, -6.4473886299265537e-12, 5.2072507417122438e-10, -2.1766125360422883e-11, 1.2591281972618162e-07, 5.2509534914646494e-11, -2.2914651946759346e-12, 2.0924261434629443e-08, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 9.402204015351856e-11, 0.0, 0.0, 0.0, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 9.402204015351856e-11, 0.0, 0.0, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 9.402204015351856e-11, 0.0, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.2499993974633981e-06, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.2499993974633981e-06, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.2499993974633981e-06,
                    ]),
                    info: SMatrix::<f64, 15, 15>::zeros(),
                    nga_walk: calib.cov_walk,
                    nga: calib.cov,
                    d_b: SMatrix::<f64, 6, 1>::zeros(),
                    measurements: vec![],
                d_t: 0.25,
                d_v: Vector3::new(2.0701899528503418, -0.087386690080165863, -1.1656434535980225),
                d_p: Vector3::new(0.26631668210029602, -0.013168445788323879, -0.14730443060398102),
                avg_a: Vector3::new(8.2807598114013672, -0.34954679012298584, -4.6625733375549316),
                avg_w: Vector3::new(-0.058985147625207901, -0.37040755152702332, 0.018500486388802528),
                d_r: Matrix3::new(   0.99570202827453613 ,-0.0041527422145009041 ,  -0.09252079576253891,
                0.0055053196847438812  ,   0.9998815655708313  , 0.014368643052875996,
                0.092450179159641266,  -0.014816244132816792 ,   0.99560701847076416),
                jrg: Matrix3::new(   -0.24943727254867554 ,-0.00047216907842084765 ,  -0.015443017706274986,
                0.0003178454062435776   , -0.24998827278614044   , 0.002007240429520607,
                0.015447699464857578 , -0.0019761091098189354 ,   -0.24942690134048462),
                jvg: Matrix3::new(0.00022254568466451019  ,  0.14121919870376587, -0.0079255066812038422,
                -0.14504142105579376 , 0.0012657083570957184  , -0.24374228715896606,
                0.0090592429041862488   , 0.24603316187858582 ,0.00079666281817480922),
                jva: Matrix3::new(   -0.24980638921260834 , 0.00074047816451638937  , 0.0074609182775020599,
                -0.00081975344801321626   , -0.24999004602432251 , -0.0016260837437584996,
                -0.0074542821384966373  , 0.0016558346105739474  ,  -0.24979956448078156),
                jpg: Matrix3::new( 1.5371855624835007e-05  ,  0.011822964996099472, -0.00079008808825165033,
                -0.012034637853503227 , 7.3119335866067559e-05 ,  -0.020676871761679649,
                0.00085786194540560246 ,   0.020801085978746414 , 4.4323242036625743e-05),
                jpa: Matrix3::new(  -0.031241860240697861 ,  7.209089380921796e-05 , 0.00049208651762455702,
                -7.5827039836440235e-05 ,  -0.031249430030584335, -0.00011655988782877102,
                -0.00049163145013153553  , 0.0001184172579087317 ,  -0.031241549178957939),
                }),
            },
            KeyFrameDummy {
                id: 66,
                prev_kf_id: 65,
                imu_position: Vector3::new(0.058819882571697235, -0.014096090570092201,-0.027865871787071228),
                velocity: Vector3::new(-0.013880491256713867, 0.001974053680896759,-0.018415972590446472),
                imu_rotation: Matrix3::new(
                    0.039319455623626709 ,  0.99915838241577148 , -0.01168707013130188,
                    -0.94294613599777222  ,0.040972232818603516 ,  0.33041486144065857,
                    0.33061560988426208 ,-0.001971489517018199 ,  0.94376343488693237,
                ), 
                pose: Pose::new(
                nalgebra::Vector3::new(0.0060903108678758144, -0.015068355947732925,0.022054105997085571),
                nalgebra::Matrix3::new(
                    0.99960166215896606 , 0.018420631065964699 , -0.02138085663318634,
                    -0.024404313415288925 ,  0.94468814134597778 , -0.32706084847450256,
                    0.014173573814332485 ,  0.32745236158370972 ,  0.94476139545440674),
                ),
                imu_preintegrated: Some(ImuPreIntegrated {
                    b: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    bu: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    c: SMatrix::<f64, 15, 15>::from_row_slice(&[
                        7.2250010418883903e-09, -2.5782227076542809e-16, -5.3099036316771545e-17, -2.1867094246452723e-10, 6.3935048366658975e-09, -4.5296849604525846e-10, -1.8351091479740234e-11, 5.2912302317409399e-10, -4.3862965343199889e-11, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 
                        -2.5956046178253272e-16, 7.2249988214423411e-09, 2.7668651506394901e-16, -6.6325602787742355e-09, -3.0896366021160304e-10, -5.7751123883065247e-09, -5.4915461067395199e-10, -2.5633981048933663e-11, -4.8132714480786376e-10, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 
                        -4.700723491712272e-17, 2.7820662156691526e-16, 7.2249974891747115e-09, 1.527089010799898e-10, 6.0425131565011725e-09, -1.1449919484762816e-10, 1.8901026577200497e-11, 5.036625005949702e-10, -9.7863210590798388e-12, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 
                        -2.1867090083116381e-10, -6.6325593905958158e-09, 1.5270894271335322e-10, 1.0082311518999632e-06, 3.1506247610835203e-10, 7.1813857083213861e-09, 1.2576633423577732e-07, 3.0675031958971033e-11, 6.7162836403511506e-10, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 
                        6.393503504398268e-09, -3.0896363245602743e-10, 6.042514488768802e-09, 3.1506233733047395e-10, 1.0144925681743189e-06, -3.6031769234945443e-10, 3.6841679013077666e-11, 1.2635175039577007e-07, -4.2121757470869881e-11, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 
                        -4.5296849604525846e-10, -5.775114608752574e-09, -1.1449918790873426e-10, 7.1813839319645467e-09, -3.6031785888290813e-10, 1.0062948376798886e-06, 6.6850236457582923e-10, -3.492545835870331e-11, 1.2558956541397492e-07, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 
                        -1.835109321446371e-11, -5.4915461067395199e-10, 1.8901028311923973e-11, 1.2576632002492261e-07, 3.6841706768653282e-11, 6.685024755981317e-10, 2.0907263476033222e-08, 3.8052260994958509e-12, 6.6527804098992505e-11, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 
                        5.2912307868524522e-10, -2.5633981048933663e-11, 5.036625005949702e-10, 3.0675018081183225e-11, 1.2635175039577007e-07, -3.492545835870331e-11, 3.8052243647723749e-12, 2.0965437386166741e-08, -4.3356112970627247e-12, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 
                        -4.3862944526518177e-11, -4.8132720031901499e-10, -9.7863210590798388e-12, 6.716280864793589e-10, -4.2121771348657688e-11, 1.2558955120312021e-07, 6.6527783282310793e-11, -4.3356125981053317e-12, 2.0889961760417464e-08, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 9.402204015351856e-11, 0.0, 0.0, 0.0, 0.0, 0.0, 
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 9.402204015351856e-11, 0.0, 0.0, 0.0, 0.0, 
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 9.402204015351856e-11, 0.0, 0.0, 0.0, 
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.2499993974633981e-06, 0.0, 0.0, 
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.2499993974633981e-06, 0.0, 
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.2499993974633981e-06, 
                    ]),
                    info: SMatrix::<f64, 15, 15>::zeros(),
                    nga_walk: calib.cov_walk,
                    nga: calib.cov,
                    d_b: SMatrix::<f64, 6, 1>::zeros(),
                    measurements: vec![],
                    d_t: 0.25,
                    d_v: Vector3::new(1.6297838687896729, -0.10458016395568848, -1.8688383102416992),
                    d_p: Vector3::new(0.2031087726354599, -0.016473818570375443, -0.23304469883441925),
                    avg_a: Vector3::new(6.5191354751586914, -0.41832068562507629, -7.4753532409667969),
                    avg_w: Vector3::new(-0.06852857768535614, 0.15851771831512451, 0.12670391798019409),
                    d_r: Matrix3::new(  0.99871641397476196 , -0.03202350065112114 , 0.039248280227184296,
                    0.031338948756456375 ,  0.99934792518615723, 0.017939526587724686,
                    -0.039797175675630569 , -0.01668650284409523  , 0.99906861782073975),
                    jrg: Matrix3::new(  -0.24985694885253906 ,-0.0037914351560175419 , 0.0064239618368446827,
                    0.0038841613568365574 ,  -0.24994130432605743 , 0.0027910768985748291,
                    -0.0063688964582979679, -0.0029159607365727425 ,  -0.24987460672855377),
                    jvg: Matrix3::new( 0.0026650598738342524 ,   0.22948653995990753 ,-0.0088258879259228706,
                    -0.22822278738021851 , 0.0031116721220314503 ,  -0.20166566967964172,
                    0.011690075509250164  ,  0.20014858245849609 ,0.00054728472605347633),
                    jva: Matrix3::new(  -0.24991364777088165  ,0.0040228697471320629 ,-0.0033827335573732853,
                    -0.0039844163693487644  , -0.24995101988315582, -0.0014471665490418673,
                    0.0034163796808570623 , 0.0013665136648342013 ,  -0.24994628131389618),
                    jpg: Matrix3::new( 0.00017287656373810023 ,   0.018997322767972946 ,-0.00097129319328814745,
                    -0.018943734467029572,  0.00019142495875712484,  -0.016756439581513405,
                    0.0011458524968475103 ,   0.016689013689756393,  2.3608617993886583e-05),
                    jpa: Matrix3::new(  -0.031245291233062744 , 0.00035179534461349249 ,-0.00019002894987352192,
                    -0.00035024480894207954,   -0.031246889382600784, -7.8246783232316375e-05,
                    0.00019160599913448095 , 7.4280731496401131e-05 ,  -0.031247766688466072),
                }),
            },
            KeyFrameDummy {
                id: 69,
                prev_kf_id: 68,
                imu_position: Vector3::new(0.051159687340259552, -0.01290072500705719,-0.031873498111963272),
                velocity: Vector3::new(-0.0056146830320358276, 0.0041640214622020721,0.0051008909940719604),
                imu_rotation: Matrix3::new(
                    0.016541123390197754  , 0.99933761358261108, -0.032417282462120056,
                    -0.94559770822525024 , 0.026170969009399414 ,  0.32428404688835144,
                    0.32491761445999146 , 0.025289693847298622 ,  0.94540417194366455
                ), 
                pose: Pose::new(
                    nalgebra::Vector3::new(0.014295722357928753, -0.018630791455507278,0.026612034067511559),
                    nalgebra::Matrix3::new(
                        0.9999765157699585,  0.0037444573827087879 , 0.0057412763126194477,
                        -0.0017037380021065474  ,  0.94709485769271851  ,  -0.3209492564201355,
                        -0.0066393138840794563 ,   0.32093194127082825 ,   0.94707900285720825),
                ),
                imu_preintegrated: Some(ImuPreIntegrated {
                    b: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    bu: ImuBias {
                        bax: 0.0,
                        bay: 0.0,
                        baz: 0.0,
                        bwx: 0.0,
                        bwy: 0.0,
                        bwz: 0.0,
                    },
                    c: SMatrix::<f64, 15, 15>::from_row_slice(&[
                        7.2249943805502426e-09, -1.7319495257926105e-18, 3.9093966092200491e-18, -9.0876819958118915e-11, 6.2554899038502754e-09, -2.4581933710798864e-10, -7.4194305213493017e-12, 5.1116499921732839e-10, -1.9057233222041781e-11, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -1.0816553867770302e-18, 7.2249943805502426e-09, 1.5302902543596341e-17, -6.2906853059985224e-09, -2.8364128754065909e-11, -5.887708542928749e-09, -5.1408827195231765e-10, -2.2592531144505212e-12, -4.8681136899375588e-10, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        4.3183729020397421e-18, 1.4652495391029571e-17, 7.2249992655315509e-09, 2.2639691510395465e-10, 5.9310285571712029e-09, 5.9504713656455266e-11, 1.7389338233253504e-11, 4.9033627158578952e-10, 4.9279985474270926e-12, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -9.0876854652588435e-11, -6.2906853059985224e-09, 2.2639692898174246e-10, 1.0073541716337786e-06, 1.7361925785941423e-10, 6.8989312040912409e-09, 1.2567544160901889e-07, 1.575416012922215e-11, 6.4029054280823061e-10, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        6.2554890156718557e-09, -2.8364127019342433e-11, 5.9310303335280423e-09, 1.7361916071489958e-10, 1.0138256811842439e-06, -1.84988580009815e-10, 1.4200246881146406e-11, 1.2627705814338697e-07, -1.5112385301496722e-11, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -2.4581930935241303e-10, -5.8877072106611195e-09, 5.950472059534917e-11, 6.8989303159128212e-09, -1.8498864939875403e-10, 1.0064815114674275e-06, 6.3458838184260458e-10, -1.6611429246027321e-11, 1.2560246887005633e-07, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -7.4194305213493017e-12, -5.1408827195231765e-10, 1.7389346906870884e-11, 1.2567539897645474e-07, 1.4200259024210737e-11, 6.345886038872095e-10, 2.0897424235499784e-08, 1.3626919688133898e-12, 6.2800001310314713e-11, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        5.1116488819502592e-10, -2.2592528976100867e-12, 4.9033616056348706e-10, 1.575415145560477e-11, 1.2627705814338697e-07, -1.6611410164069085e-11, 1.3626905593505656e-12, 2.0957044100100575e-08, -1.4356007702054363e-12, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        -1.9057228017871353e-11, -4.8681142450490711e-10, 4.9279985474270926e-12, 6.4029043178592815e-10, -1.5112397444561054e-11, 1.2560248308091104e-07, 6.2799987432526905e-11, -1.4356031554502158e-12, 2.0890945862106491e-08, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 9.402204015351856e-11, 0.0, 0.0, 0.0, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 9.402204015351856e-11, 0.0, 0.0, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 9.402204015351856e-11, 0.0, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.2499993974633981e-06, 0.0, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.2499993974633981e-06, 0.0,
                        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.2499993974633981e-06,
                    ]),
                    info: SMatrix::<f64, 15, 15>::zeros(),
                    nga_walk: calib.cov_walk,
                    nga: calib.cov,
                    d_b: SMatrix::<f64, 6, 1>::zeros(),
                    measurements: vec![],
                    d_t: 0.25,
                    d_v: Vector3::new(1.6525261402130127, -0.043950427323579788, -1.7596907615661621),
                    d_p: Vector3::new(0.20516224205493927, -0.0052816732786595821, -0.21776092052459717),
                    avg_a: Vector3::new(6.6101045608520508, -0.17580167949199677, -7.0387630462646484),
                    avg_w: Vector3::new(0.041259612888097763, 0.025544656440615654, 0.056988492608070374),
                    d_r: Matrix3::new(    0.9998781681060791 , -0.014213079586625099 , 0.0064421319402754307,
                    0.01427875179797411  ,  0.99984520673751831 , -0.010278140194714069,
                    -0.0062950532883405685 ,  0.010368882678449154  ,  0.99992650747299194),
                    jrg: Matrix3::new(   -0.24999132752418518,  -0.0017796918982639909 , 0.00059901876375079155,
                    0.0017766868695616722 ,   -0.24998970329761505, -0.00091356993652880192,
                    -0.0006075175479054451 , 0.00090818374883383512  ,  -0.24999669194221497),
                    jvg: Matrix3::new( 0.0011452732142060995 ,   0.21772448718547821 ,-0.0067476998083293438,
                    -0.21710048615932465 , 4.397138036438264e-05  ,  -0.2045445442199707,
                    0.0066465861164033413 ,   0.20380145311355591 ,-0.0010557437781244516),
                    jva: Matrix3::new(   -0.24999029934406281 ,   0.001743171364068985, -0.00098224740941077471,
                    -0.0017504391726106405  ,  -0.24998617172241211  , 0.0016386364586651325,
                    0.00096869486151263118 , -0.0016465747030451894 ,   -0.24999165534973145),
                    jpg: Matrix3::new( 7.6899748819414526e-05  ,  0.017793143168091774 ,-0.00049818673869594932,
                    -0.017747515812516212 , 1.9841311882373702e-07 ,  -0.016903966665267944,
                    0.0004902564687654376,    0.016850877553224564, -7.3626360972411931e-05),
                    jpa: Matrix3::new(  -0.031249305233359337  ,0.00015725164848845452, -9.9748831416945904e-05,
                    -0.00015787160373292863 , -0.031248956918716431 , 0.00016147294081747532,
                    9.8718010121956468e-05, -0.00016208238957915455  , -0.031249290332198143),
                }),
            },
        ];

        // Set KeyFrame vertices (fixed poses and optimizable velocities)
        for kf in &keyframes {
            let imu_calib = ImuCalib::new();

            let rot = kf.pose.get_quaternion();
            let imu_rot = nalgebra::geometry::UnitQuaternion::from_rotation_matrix(
                & nalgebra::Rotation3::from_matrix(& kf.imu_rotation)
            ); // lol whateverrr
            let tcb_rot = imu_calib.tcb.get_quaternion();

            optimizer.pin_mut().add_vertex_pose(
                kf.id,
                true,
                1, // TODO (Stereo... num cams shouldn't be 1)
                kf.imu_position.into(), // imu position
                [imu_rot.i, imu_rot.j, imu_rot.k, imu_rot.w], // imu rotation
                kf.pose.get_translation().into(), // translation
                [rot.i, rot.j, rot.k, rot.w], // rotation
                imu_calib.tcb.translation.into(), //tcb translation
                [tcb_rot.i, tcb_rot.j, tcb_rot.k, tcb_rot.w], // tcb rotation
                imu_calib.tbc.translation.into(), // tbc translation
                CAMERA_MODULE.stereo_baseline as f32
            );

            optimizer.pin_mut().add_vertex_velocity(
                max_kf_id + kf.id + 1,
                fixed_velocity,
                kf.velocity.into()
            );
        }

        // Biases
        optimizer.pin_mut().add_vertex_gyrobias(
            140,
            false,
            [0.0,0.0,0.0]
        );

        optimizer.pin_mut().add_vertex_accbias(
            141,
            false,
            [0.0,0.0,0.0]
        );

        // prior acc bias
        optimizer.pin_mut().add_edge_prior_for_imu(
            141,
            140,
            [0.0, 0.0, 0.0],
            10000000000.0,
            100.0
        );
    
        optimizer.pin_mut().add_vertex_gdir(
            max_kf_id * 2 + 4,
            false,
            (&mut rwg).into(),
        );
        optimizer.pin_mut().add_vertex_scale(
            max_kf_id * 2 + 5,
            false,  // Fixed for stereo case
            1.0,
        );

        {

            // Graph edges
            // IMU links with gravity and scale
            let mut new_imu_preintegrated_for_kfs: HashMap<Id, ImuPreIntegrated> = HashMap::new();
            for kf in & keyframes {
                if kf.imu_preintegrated.is_none() {
                    continue;
                }

                optimizer.pin_mut().add_edge_inertial_gs(
                    kf.prev_kf_id,
                    max_kf_id + kf.prev_kf_id + 1,
                    max_kf_id * 2 + 2,
                    max_kf_id * 2 + 3,
                    kf.id,
                    max_kf_id + kf.id + 1,
                    max_kf_id * 2 + 4,
                    max_kf_id * 2 + 5,
                    (kf.imu_preintegrated.as_ref().unwrap()).into(),
                    false,
                    1.0,
                    false,
                    0.0
                );
            }
        }

        println!("OPTIMIZE!");
        // Compute error for different scales
        optimizer.pin_mut().optimize(its, false, false);
        println!("OPTIMIZATION DONE!");

        let estimate = optimizer.recover_optimized_inertial(
            max_kf_id * 2 + 2,
            max_kf_id * 2 + 3,
            max_kf_id * 2 + 5,
            max_kf_id * 2 + 4,
        );

        let vb = estimate.vb;
        let res_bg: DVVector3<f64> = estimate.bg.into();
        let res_ba: DVVector3<f64> = estimate.ba.into();
        let res_scale = estimate.scale;
        let res_rwg: DVMatrix3<f64> = estimate.rwg.into();

        let res_b = ImuBias {
            bax: vb[0],
            bay: vb[1],
            baz: vb[2],
            bwx: vb[3],
            bwy: vb[4],
            bwz: vb[5],
        };

        println!("INERTIAL OPTIMIZATION RESULTS! bg: {:?}", res_bg);
        println!("INERTIAL OPTIMIZATION RESULTS! ba: {:?}", res_ba);
        println!("INERTIAL OPTIMIZATION RESULTS! scale: {:?}", res_scale);
        println!("INERTIAL OPTIMIZATION RESULTS! bias: {:?}", res_b);
        println!("INERTIAL OPTIMIZATION RESULTS! rwg: {:?}", res_rwg);

        println!("Keyframes: {:?}", keyframes.iter().map(|kf| kf.id).collect::<Vec<_>>());

        //Keyframes velocities and biases
        for kf in &mut keyframes {
            let velocity = optimizer.recover_optimized_vertex_velocity(max_kf_id + kf.id + 1);
            println!("INERTIAL OPTIMIZATION! Set KF velocity {} {:?}", kf.id, velocity);

            if kf.imu_preintegrated.is_none() {
                continue;
            }
            if (* kf.imu_preintegrated.as_ref().unwrap().b.get_gyro_bias() - *res_bg).norm() > 0.01 {
                kf.imu_preintegrated.as_mut().unwrap().set_new_bias(res_b);
                println!("INERTIAL OPTIMIZATION RESULTS! SET KF bias {} {:?} AND REINTEGRATE", kf.id, res_b);
                // if let Some(imu_preintegrated) = kf.imu_data.imu_preintegrated.as_mut() {
                //     imu_preintegrated.reintegrate();
                // }
            } else {
                kf.imu_preintegrated.as_mut().unwrap().set_new_bias(res_b);
                println!("INERTIAL OPTIMIZATION RESULTS! SET KF bias {} {:?}", kf.id, res_b);
            }
        }

        assert_eq!(1, -1); // just to get output from above, the actual assert doesn't matter

    }

    // #[test]
    fn test_imu_preintegrated() {
        let mut system_config = env::current_dir().unwrap();
        system_config.push("orbslam_config.yaml");
        let mut dataset_config = env::current_dir().unwrap();
        dataset_config.push("config_datasets/EUROC.yaml");
        let _ = load_config(
            &system_config.into_os_string().into_string().unwrap(),
            &dataset_config.into_os_string().into_string().unwrap()
        ).expect("Could not load config");

        let bias = ImuBias::new(); // init with all 0s
        let mut preintegrated = ImuPreIntegrated::new(bias);

        // Nga and NgaWalk taken from dataset configuration. For euroc, should be:
        // Nga = {5.78000027e-06, 5.78000027e-06, 5.78000027e-06, 0.000800000038, 0.000800000038, 0.000800000038}
        // Ngawalk = {1.88044198e-12, 1.88044198e-12, 1.88044198e-12, 4.50000037e-08,  4.50000037e-08, 4.50000037e-08}

        // Start off with:
        // everyhting 0s except nga, ngawalk
        // dR = 1, 0, 0, 0, 1, 0, 0, 0, 1

        let acc = Vector3::new(7.95973063, -0.416782618, -2.41897345);
        let ang_vel = Vector3::new(-0.0987856388, 0.13404128, 0.0335103199);
        let dt = 0.00499987602;
        preintegrated.integrate_new_measurement(acc, ang_vel, dt);

        println!("preintegrated: {:?}", preintegrated);

        // dR
        // assert_eq!(preintegrated.get_original_delta_rotation(), nalgebra::Matrix3::new(0.999999762, 0.000167460079, -0.000670200272, -0.000167651044, 0.999999821, -0.000493822154, 0.000670123554, 0.000493980129, 0.999999702));
    
        // dV
        assert!(preintegrated.get_original_delta_velocity() - nalgebra::Vector3::new(0.0397976674, -0.0020838615, -0.0120945675) < nalgebra::Vector3::new(1e-6, 1e-6, 1e-6));

        // dP
        assert!(preintegrated.get_original_delta_position() - nalgebra::Vector3::new(9.94916991e-05, -5.20952472e-06, -3.02356693e-05) < nalgebra::Vector3::new(1e-6, 1e-6, 1e-6));

        // Other values that I'm not testing for...

        // C = {1.4449282e-10, -3.98521764e-18, 
        //   -9.93819352e-19, 0 <repeats 12 times>, -3.98475194e-18, 1.4449282e-10, 1.35275897e-18, 0 <repeats 12 times>, 
        //   -9.96584617e-19, 1.35143404e-18, 1.44492834e-10, 0 <repeats 15 times>, 1.99990087e-08, 0, 0, 4.99962814e-11, 
        //   0 <repeats 12 times>, 1.99990087e-08, 0, 0, 4.99962814e-11, 0 <repeats 12 times>, 1.99990087e-08, 0, 0, 4.99962814e-11, 0, 
        //   0, 0, 0, 0, 0, 0, 0, 0, 4.99962814e-11, 0, 0, 1.24987612e-13, 0 <repeats 12 times>, 4.99962814e-11, 0, 0, 1.24987612e-13, 
        //   0 <repeats 12 times>, 4.99962814e-11, 0, 0, 1.24987612e-13, 0 <repeats 15 times>, 1.88044198e-12, 0 <repeats 15 times>, 
        //   1.88044198e-12, 0 <repeats 15 times>, 1.88044198e-12, 0 <repeats 15 times>, 4.50000037e-08, 0 <repeats 15 times>, 
        //   4.50000037e-08, 0 <repeats 15 times>, 4.50000037e-08}}}},

        // info = all 0s
        // b = all 0s
        // JRg = -0.00499987556, 4.19134011e-07, -1.67536382e-06, -4.18582374e-07, 
        //   -0.00499987556, -1.23485268e-06, 1.67550172e-06, 1.23466543e-06, -0.00499987556
        // JVg = all 0s
        // JVa = -0.00499987602, 0, 0, 0, -0.00499987602, 0, 0, 0, -0.00499987602
        // JPg = all 0s
        // JPa = -1.24993803e-05, 0, 0, 0, -1.24993803e-05, 0, 0, 0, -1.24993803e-05
        // avgA = {7.95973063, -0.416782647, -2.41897345}
        // avgW = -0.0987856314, 0.13404128, 0.0335103199

    }

    // #[test]
    fn test_integrated_rotation() {
        let ir = IntegratedRotation::new(
            Vector3::new(-0.0987856388, 0.13404128, 0.0335103199),
            ImuBias::new(),
            0.00499987602
        );

        assert!(
            ir.delta_r - nalgebra::Matrix3::new(
                0.999999762, 0.000167381921, -0.000670231122,
                -0.000167712948, 0.999999881, -0.000493859698,
                0.000670148351, 0.000493972038, 0.999999642
            ) < nalgebra::Matrix3::new(
                1e-6, 1e-6, 1e-6,
                1e-6, 1e-6, 1e-6,
                1e-6, 1e-6, 1e-6
            )
        );
        assert_eq!(ir.right_j, nalgebra::Matrix3::new(0.99999994, -8.38288834e-05, 0.000335081073, 8.37185507e-05, 
            0.99999994, 0.000246976648, -0.000335108663, -0.00024693922, 0.999999881));
    }

    // #[test]
    fn test_imu_utils() {
        // input = 0.999999762;, 0.000167381921, 
        //   -0.000670231122, -0.000167712948, 0.999999881, -0.000493859698, 0.000670148351, 0.000493972038, 
        //   0.999999642


        // matrix u = 0.818077385, 0.575106502, -0.00139272108, -0.407460123, 
        //     0.577891409, -0.707119346, -0.40586406, 0.579045773, 0.707092881

        // matrix v = 0.818174362, 0.574969888, -0.000560401008, -0.406889349, 
        //     0.578308821, -0.707106709, -0.40624091, 0.578764558, 0.707106709


        // let r = nalgebra::Matrix3::new(
        // 0.999999762, 0.000167381921, -0.000670231122,
        // -0.000167712948, 0.999999881, -0.000493859698,
        // 0.000670148351, 0.000493972038, 0.999999642
        // );
        // let res = crate::modules::imu::normalize_rotation(r).unwrap();
        // assert_eq!(res, nalgebra::Matrix3::new(
        //     0.999999762, 0.000167460079, -0.000670200272,
        //     -0.000167651044, 0.999999821, -0.000493822154,
        //     0.000670123554, 0.000493980129, 0.999999702
        // ));

        // let v = nalgebra::Vector3::new(0.0397976674, -0.0020838615, -0.0120945675);
        // let res = crate::modules::imu::hat(& v);
        // assert_eq!(res, nalgebra::Matrix3::new(
        //     0.0, -0.0120945675, 0.0020838615,
        //     0.0120945675, 0.0, -0.0397976674,
        //     -0.0020838615, 0.0397976674, 0.0
        // ));

    }
}